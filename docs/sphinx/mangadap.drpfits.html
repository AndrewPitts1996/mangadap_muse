

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mangadap.drpfits module &mdash; mangadap 2.2.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="mangadap 2.2.2 documentation" href="index.html"/>
        <link rel="up" title="mangadap package" href="mangadap.html"/>
        <link rel="prev" title="mangadap.dapfits module" href="mangadap.dapfits.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mangadap
          

          
          </a>

          
            
            
              <div class="version">
                2.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mangadap.html">mangadap package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mangadap.html#subpackages">Subpackages</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="mangadap.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mangadap.dapfits.html">mangadap.dapfits module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">mangadap.drpfits module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mangadap.html#module-mangadap">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mangadap</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="mangadap.html">mangadap package</a> &raquo;</li>
        
      <li>mangadap.drpfits module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/mangadap.drpfits.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-mangadap.drpfits">
<span id="mangadap-drpfits-module"></span><h1>mangadap.drpfits module<a class="headerlink" href="#module-mangadap.drpfits" title="Permalink to this headline">Â¶</a></h1>
<p>Defines a class used to interface with files produced in the 3D phase of
the MaNGA Data Reduction Pipeline (DRP).</p>
<dl class="docutils">
<dt><em>License</em>:</dt>
<dd><dl class="first last docutils">
<dt>Copyright (c) 2016, SDSS-IV/MaNGA Pipeline Group</dt>
<dd>Licensed under BSD 3-clause license - see LICENSE.rst</dd>
</dl>
</dd>
<dt><em>Source location</em>:</dt>
<dd>$MANGADAP_DIR/python/mangadap/drpfits.py</dd>
<dt><em>Imports and python version compliance</em>:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="k">import</span> <span class="n">WCS</span>

<span class="kn">from</span> <span class="nn">.util.parser</span> <span class="k">import</span> <span class="n">arginp_to_list</span>
<span class="kn">from</span> <span class="nn">.util.covariance</span> <span class="k">import</span> <span class="n">Covariance</span>
<span class="kn">from</span> <span class="nn">.config.defaults</span> <span class="k">import</span> <span class="n">default_idlutils_dir</span><span class="p">,</span> <span class="n">default_drp_version</span>
<span class="kn">from</span> <span class="nn">.config.defaults</span> <span class="k">import</span> <span class="n">default_redux_path</span><span class="p">,</span> <span class="n">default_drp_directory_path</span>
<span class="kn">from</span> <span class="nn">.config.defaults</span> <span class="k">import</span> <span class="n">default_cube_pixelscale</span><span class="p">,</span> <span class="n">default_cube_width_buffer</span>
<span class="kn">from</span> <span class="nn">.config.defaults</span> <span class="k">import</span> <span class="n">default_cube_recenter</span><span class="p">,</span> <span class="n">default_regrid_rlim</span>
<span class="kn">from</span> <span class="nn">.config.defaults</span> <span class="k">import</span> <span class="n">default_regrid_sigma</span>
<span class="kn">from</span> <span class="nn">.config.defaults</span> <span class="k">import</span> <span class="n">default_manga_fits_root</span>
<span class="kn">from</span> <span class="nn">.util.bitmask</span> <span class="k">import</span> <span class="n">BitMask</span>
</pre></div>
</div>
</dd>
</dl>
<p><em>Class usage examples</em>:</p>
<blockquote>
<div>This class provides a basic interface with DRP LOG* files.  It provides a number of</div></blockquote>
<dl class="docutils">
<dt><em>Revision history</em>:</dt>
<dd><div class="first last line-block">
<div class="line"><strong>20 Nov 2014</strong>: Original implementation by K. Westfall (KBW)</div>
<div class="line"><strong>12 Feb 2014</strong>: (KBW) Added <a class="reference internal" href="#mangadap.drpfits.DRPFits.directory_path" title="mangadap.drpfits.DRPFits.directory_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.directory_path()</span></code></a></div>
<div class="line"><strong>20 Feb 2015</strong>: (KBW) Add covariance calculation to <a class="reference internal" href="#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFits</span></code></a></div>
<div class="line"><strong>19 Mar 2015</strong>: (KBW) Added redux_path to <a class="reference internal" href="#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFits</span></code></a>.
Re-arranged arguments in <a class="reference internal" href="#mangadap.drpfits.drpfits_list" title="mangadap.drpfits.drpfits_list"><code class="xref py py-func docutils literal notranslate"><span class="pre">drpfits_list()</span></code></a>, made drpver
optional, and added redux_path</div>
<div class="line"><strong>22 May 2015</strong>: (KBW) Sphinx documentation.  Changed DRPFits.w to
<a class="reference internal" href="#mangadap.drpfits.DRPFits.wcs" title="mangadap.drpfits.DRPFits.wcs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DRPFits.wcs</span></code></a>.</div>
<div class="line"><strong>26 May 2015</strong>: (KBW) Added checksum=True when opening the DRP
file.</div>
<div class="line"><strong>04 Jun 2015</strong>: (KBW) Moved parse_drp_file_name to
<a class="reference internal" href="mangadap.util.parser.html#mangadap.util.parser.parse_drp_file_name" title="mangadap.util.parser.parse_drp_file_name"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.util.parser.parse_drp_file_name()</span></code></a></div>
<div class="line"><strong>15 Jun 2015</strong>: (KBW) Moved functions that return default values
(like <code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits._default_pixelscale()</span></code>) to
<a class="reference internal" href="mangadap.config.defaults.html#module-mangadap.config.defaults" title="mangadap.config.defaults"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mangadap.config.defaults</span></code></a></div>
<div class="line"><strong>05 Aug 2015</strong>: (KBW) Changed mode testing to be more robust.
Added directory_path keyword to <a class="reference internal" href="#mangadap.drpfits.drpfits_list" title="mangadap.drpfits.drpfits_list"><code class="xref py py-func docutils literal notranslate"><span class="pre">drpfits_list()</span></code></a>.  Changed
how directory path is set; previously required drpver and
redux_path defaults, even if directory_path was provided
directly.  <strong>May need to add checks to other code to make sure
drpver and redux_path are not None when directory_path has been
directly defined.</strong></div>
<div class="line"><strong>28 Aug 2015</strong>: (KBW) Added usage of
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_manga_fits_root" title="mangadap.config.defaults.default_manga_fits_root"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_manga_fits_root()</span></code></a></div>
<div class="line"><strong>15 Feb 2016</strong>: (KBW) Added <code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.__getitem__()</span></code>
function</div>
<div class="line"><strong>17 Feb 2016</strong>: (KBW) Converted drpfile class name to DRPFits</div>
<div class="line"><strong>23 Mar 2016</strong>: (KBW) Added functionality that abstracts the
difference between the RSS and CUBE file formats at the user
level.  CUBE files are now restructured to matched the
<em>intended</em> orientation provided by the DRP; i.e., [x,y,lambda].
RSS files are left the same, which is [fiber, lambda].
Documentation.  Testing, particularly of x,y order.</div>
<div class="line"><strong>10 Nov 2016</strong>: (KBW) Included âDISPâ in spectral arrays.</div>
<div class="line"><strong>30 Nov 2016</strong>: (KBW) Include
<a class="reference internal" href="#mangadap.drpfits.DRPFits.spectral_resolution" title="mangadap.drpfits.DRPFits.spectral_resolution"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.spectral_resolution()</span></code></a>, which returns spectral
resolution cube or vector independent of MPL</div>
<div class="line"><strong>01 Dec 2016</strong>: (KBW) Added
<a class="reference internal" href="#mangadap.drpfits.DRPFits.spectral_resolution_header" title="mangadap.drpfits.DRPFits.spectral_resolution_header"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.spectral_resolution_header()</span></code></a>.</div>
<div class="line"><strong>06 Dec 2016</strong>: (KBW) Removed wavelength_mask function, now uses
<a class="reference internal" href="mangadap.util.pixelmask.html#mangadap.util.pixelmask.SpectralPixelMask" title="mangadap.util.pixelmask.SpectralPixelMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.pixelmask.SpectralPixelMask</span></code></a>.  Moved the
main functionality of <a class="reference internal" href="#mangadap.drpfits.DRPFits.copy_to_array" title="mangadap.drpfits.DRPFits.copy_to_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.copy_to_array()</span></code></a> and
<a class="reference internal" href="#mangadap.drpfits.DRPFits.copy_to_masked_array" title="mangadap.drpfits.DRPFits.copy_to_masked_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.copy_to_masked_array()</span></code></a> to
<a class="reference internal" href="mangadap.util.fitsutil.html#mangadap.util.fitsutil.DAPFitsUtil" title="mangadap.util.fitsutil.DAPFitsUtil"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.fitsutil.DAPFitsUtil</span></code></a>, whatâs left are
wrapper functions for the more general functions in
<a class="reference internal" href="mangadap.util.fitsutil.html#mangadap.util.fitsutil.DAPFitsUtil" title="mangadap.util.fitsutil.DAPFitsUtil"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.fitsutil.DAPFitsUtil</span></code></a>.</div>
<div class="line"><strong>17 Feb 2017</strong>: (KBW) Return nominal inverse variance in
<a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_wavelength_plane" title="mangadap.drpfits.DRPFits.regrid_wavelength_plane"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.regrid_wavelength_plane()</span></code></a> if requested.</div>
<div class="line"><strong>17 May 2017</strong>: (KBW) Include a response function in
<a class="reference internal" href="#mangadap.drpfits.DRPFits.flux_stats" title="mangadap.drpfits.DRPFits.flux_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.flux_stats()</span></code></a> and
<code class="xref py py-func docutils literal notranslate"><span class="pre">DAPFits.mean_sky_coordinates()</span></code>.</div>
<div class="line"><strong>21 Aug 2017</strong>: (KBW) In spectral resolution function, select
pre- vs. post-pixelized Gaussian respresentation.</div>
</div>
</dd>
</dl>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Calculation in <a class="reference internal" href="#mangadap.drpfits.DRPFits._cube_dimensions" title="mangadap.drpfits.DRPFits._cube_dimensions"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits._cube_dimensions()</span></code></a> will only be
correct if the WCS coordinates have no rotation.</li>
<li>Further optimize calculation of transfer matrix</li>
<li>Make DRP file class flexible to linear or log-linear wavelength
sampling?  Incorporate into MODE?</li>
<li>Reconstructed broad-band images and PSFs are <em>not</em> restructured in
the CUBE files!  This is why the are transposed in
<code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.drpfits.DRPFits.gri_composite()</span></code>.</li>
<li>Image reconstruction has transpose sense wrt DRP output!</li>
<li>Add logging</li>
<li>Need to be clear about which functions use the RSS spectra to
create CUBE related data, like the covariance matrix and
instrumental dispersion calculations.</li>
<li>Computing the approximate covariance cube is currently not
possible with only the CUBE on disk.  Thereâs a logic problem that
needs to be fixed.</li>
</ul>
</div>
<dl class="class">
<dt id="mangadap.drpfits.DRPFits">
<em class="property">class </em><code class="descclassname">mangadap.drpfits.</code><code class="descname">DRPFits</code><span class="sig-paren">(</span><em>plate</em>, <em>ifudesign</em>, <em>mode</em>, <em>drpver=None</em>, <em>redux_path=None</em>, <em>directory_path=None</em>, <em>read=False</em>, <em>checksum=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A general purpose class used to interface with a MaNGA DRP file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>plate</strong> (<em>int</em>) â Plate number</li>
<li><strong>ifudesign</strong> (<em>int</em>) â IFU design</li>
<li><strong>mode</strong> (<em>str</em>) â 3D mode of the DRP file; must be either âRSSâ or
âCUBEâ</li>
<li><strong>drpver</strong> (<em>str</em>) â (<strong>Optional</strong>) DRP version, which is used to
define the default DRP redux path.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_drp_version" title="mangadap.config.defaults.default_drp_version"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_drp_version()</span></code></a></li>
<li><strong>redux_path</strong> (<em>str</em>) â (<strong>Optional</strong>) The path to the top level
directory containing the DRP output files for a given DRP
version.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_redux_path" title="mangadap.config.defaults.default_redux_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_redux_path()</span></code></a>.</li>
<li><strong>directory_path</strong> (<em>str</em>) â (<strong>Optional</strong>) The exact path to the DRP
file.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_drp_directory_path" title="mangadap.config.defaults.default_drp_directory_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_drp_directory_path()</span></code></a>.</li>
<li><strong>read</strong> (<em>bool</em>) â (<strong>Optional</strong>) Read the DRP file upon
instantiation of the object.</li>
<li><strong>checksum</strong> (<em>bool</em>) â (<strong>Optional</strong>) Check for file corruption.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised if <em>mode</em> is not âRSSâ or âCUBEâ.</p>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">plate, ifudesign</code></dt>
<dd><p><em>int</em> â Plate and IFU designation</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.mode">
<code class="descname">mode</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.mode" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>str</em> â 3D mode of the DRP file, see above</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.drpver">
<code class="descname">drpver</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.drpver" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>str</em> â DRP version, which is used to define the default
DRP redux path, see above.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.redux_path">
<code class="descname">redux_path</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.redux_path" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>str</em> â The path to the top level directory containing
the DRP output files for a given DRP version, see above.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.directory_path">
<code class="descname">directory_path</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.directory_path" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>str</em> â The exact path to the DRP file, see above.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.pixelscale">
<code class="descname">pixelscale</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.pixelscale" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>float</em> â Pixel scale used during the CUBE reconstruction.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.recenter">
<code class="descname">recenter</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.recenter" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>bool</em> â If False, the coordinates in the XPOS and YPOS
extensions of the DRP file are assumed to be centered at
0,0.  If True, the XPOS and YPOS can have any center, and
the center of the CUBE is set to be approximately the center
of the range in XPOS,YPOS.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.width_buffer">
<code class="descname">width_buffer</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.width_buffer" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>float</em> â The number of pixels to add to the width
of the cube in addition to the range needed to cover XPOS
and YPOS.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">xs, ys</code></dt>
<dd><p><em>float</em> â The starting on-sky coordinate of the
reconstructed image defined by the bottom corner of the
first pixel, not its center!</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">nx, ny</code></dt>
<dd><p><em>int</em> â The size (number of pixel in x and y) of the
reconstructed image.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.regrid_T">
<code class="descname">regrid_T</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.regrid_T" title="Permalink to this definition">Â¶</a></dt>
<dd><p><a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a> â Transfer matrix <span class="math notranslate nohighlight">\({\mathbf
T}\)</span> such that:</p>
<div class="math notranslate nohighlight">
\[{\mathbf T} \times {\mathbf F} = {\mathbf I}\]</div>
<p>where <span class="math notranslate nohighlight">\({\mathbf F}\)</span> is the vector of fluxes in a
single wavelength channel for all the fiber measurements in
the field of view and <span class="math notranslate nohighlight">\({\mathbf I}\)</span> is the
pre-formatted reconstructed image of that wavelength
channel.  Saved such that repeat calls to create T for a
given wavelength channel do not result in repeat
calculations.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.regrid_channel">
<code class="descname">regrid_channel</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.regrid_channel" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>int</em> â Wavelength channel for which
<a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_T" title="mangadap.drpfits.DRPFits.regrid_T"><code class="xref py py-attr docutils literal notranslate"><span class="pre">regrid_T</span></code></a> has been calculated.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.regrid_rlim">
<code class="descname">regrid_rlim</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.regrid_rlim" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>float</em> â The limiting radius of the Gaussian
interpolation kernel used during image construction in
arcseconds.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.regrid_sigma">
<code class="descname">regrid_sigma</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.regrid_sigma" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>float</em> â The sigma of the Gaussian interpolation
kernel used during image construction in arcseconds.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.sigma_rho">
<code class="descname">sigma_rho</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.sigma_rho" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>float</em> â The sigma, <span class="math notranslate nohighlight">\(\sigma_\rho\)</span>, of the
Gaussian function used to approximate the trend of the
correlation coefficient <span class="math notranslate nohighlight">\(\rho\)</span> with pixel separation
as stored in <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a>.  That is:</p>
<div class="math notranslate nohighlight">
\[\rho_{ij} = \exp\left(\frac{-d^2_{ij}}{2
\sigma^2_\rho}\right)\]</div>
<p>where <span class="math notranslate nohighlight">\(d_{ij}\)</span> is the distance between pixels
<span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.cov_rho">
<code class="descname">cov_rho</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.cov_rho" title="Permalink to this definition">Â¶</a></dt>
<dd><p><a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a> â The matrix <span class="math notranslate nohighlight">\({\mathbf
R}\)</span> containing the correlation coefficents, <span class="math notranslate nohighlight">\(\rho\)</span>,
between elements of the covariance matrix, <span class="math notranslate nohighlight">\({\mathbf
C}\)</span>, as approximated using the parameterization of
<span class="math notranslate nohighlight">\(\rho\)</span> with pixel separation.  This matrix will be
<em>independent of wavelength</em>.  In general,</p>
<div class="math notranslate nohighlight">
\[\begin{split}{\mathbf C} = \left[
\begin{array}{rrrr}
    ... &amp; ... &amp; ... &amp; ... \\
    ... &amp; \sigma^2_i &amp; \rho_{ij}\sigma_i\sigma_j &amp; ... \\
    ... &amp; \rho_{ji}\sigma_j\sigma_i &amp; \sigma^2_j &amp; ... \\
    ... &amp; ... &amp; ... &amp; ...
\end{array}
\right]\end{split}\]</div>
<p>such that</p>
<div class="math notranslate nohighlight">
\[\begin{split}{\mathbf R} = \left[
\begin{array}{rrrr}
    ... &amp; ... &amp; ... &amp; ... \\
    ... &amp; 1.0 &amp; \rho_{ij} &amp; ... \\
    ... &amp; \rho_{ji} &amp; 1.0 &amp; ... \\
    ... &amp; ... &amp; ... &amp; ...
\end{array}
\right].\end{split}\]</div>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.bitmask">
<code class="descname">bitmask</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.bitmask" title="Permalink to this definition">Â¶</a></dt>
<dd><p><a class="reference internal" href="#mangadap.drpfits.DRPFitsBitMask" title="mangadap.drpfits.DRPFitsBitMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFitsBitMask</span></code></a> â Object used to interpret the
DRP bit mask values in the <cite>MASK</cite> extension.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.hdu">
<code class="descname">hdu</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.hdu" title="Permalink to this definition">Â¶</a></dt>
<dd><p><a class="reference external" href="http://docs.astropy.org/en/v1.0.2/io/fits/api/hdulists.html">astropy.io.fits.hdu.hdulist.HDUList</a> â HDUList read from
the DRP file</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.ext">
<code class="descname">ext</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.ext" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>list</em> â List of fits extensions in the file</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.checksum">
<code class="descname">checksum</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.checksum" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>bool</em> â Flag to check for file corruption when opening
the HDU.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.wcs">
<code class="descname">wcs</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.wcs" title="Permalink to this definition">Â¶</a></dt>
<dd><p><a class="reference external" href="http://docs.astropy.org/en/v1.0.2/api/astropy.wcs.WCS.html">astropy.wcs.wcs.WCS</a> â WCS object based on WCS keywords
in the header of the FLUX extension.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.shape">
<code class="descname">shape</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.shape" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>tuple</em> â Shape of the main data arrays</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.spatial_shape">
<code class="descname">spatial_shape</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.spatial_shape" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>tuple</em> â Shape of the spatial axes only.  For RSS
files, this is a single element with the number of fibers;
for CUBE files, this has the x and y dimensions of the data
cube.  <em>These are transposed w.r.t. the read-in DRP file!</em></p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.nspec">
<code class="descname">nspec</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.nspec" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>int</em> â Number of spectra in the DRP file; this is just:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">nspec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_shape</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.spatial_index">
<code class="descname">spatial_index</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.spatial_index" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>numpy.ndarray</em> â Array with tuples used to select
spectra at specific locations within the data array.  This
is mainly useful in <code class="docutils literal notranslate"><span class="pre">CUBE</span></code> mode, where this provides the
indices in the spatial coordinates.  The order is
<span class="math notranslate nohighlight">\((x,y)\)</span>; i.e. this is <em>different</em> that what you get if
you read the DRP CUBE fits file directly using
<a class="reference external" href="http://docs.astropy.org/en/stable/io/fits/index.html">astropy.io.fits</a>.  In <code class="docutils literal notranslate"><span class="pre">RSS</span></code> mode, this is just the index
of the spectrum in the 2D array.  See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.select" title="mangadap.drpfits.DRPFits.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.spectral_arrays">
<code class="descname">spectral_arrays</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.spectral_arrays" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>list</em> â List of viable keywords for the data
arrays in the DRP file.  For CUBE files, these are âFLUXâ,
âIVARâ, and âMASKâ; for RSS files, this also includes
âDISPâ, âXPOSâ, and âYPOSâ.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.dispaxis">
<code class="descname">dispaxis</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.dispaxis" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>int</em> â Index of the axis with the spectral channels.
The internal data structure always has <a class="reference internal" href="#mangadap.drpfits.DRPFits.dispaxis" title="mangadap.drpfits.DRPFits.dispaxis"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dispaxis</span></code></a> as
the <em>last</em> axis in the array.  So <a class="reference internal" href="#mangadap.drpfits.DRPFits.dispaxis" title="mangadap.drpfits.DRPFits.dispaxis"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dispaxis</span></code></a> is 2 for
CUBE files and 1 for RSS files.  This means that the
internal data array restructures the input fits data for the
CUBE files.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.nwave">
<code class="descname">nwave</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.nwave" title="Permalink to this definition">Â¶</a></dt>
<dd><p><em>int</em> â The number of wavelength channels; this is just:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">nwave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dispaxis</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._approximate_covariance_matrix">
<code class="descname">_approximate_covariance_matrix</code><span class="sig-paren">(</span><em>channel</em>, <em>pixelscale</em>, <em>recenter</em>, <em>width_buffer</em>, <em>rlim</em>, <em>sigma</em>, <em>sigma_rho</em>, <em>csr=False</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._approximate_covariance_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._approximate_covariance_matrix" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return an approximate calculation of the covariance matrix
assuming</p>
<div class="math notranslate nohighlight">
\[C_{ij} = \frac{\rho_{ij}}{(V^{-1}_{ii} V^{-1}_{jj})^{1/2}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho_{ij}\)</span> is approximated by a Gaussian with a
standard deviation defined by the provided <em>sigma_rho</em>.  See the
description of attributes <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a> and <a class="reference internal" href="#mangadap.drpfits.DRPFits.sigma_rho" title="mangadap.drpfits.DRPFits.sigma_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sigma_rho</span></code></a>.
For this to work, the variance matrix of the reconstructed image
must have been already calculated, meaning that this approach is
most appropriately used with the âCUBEâ files.  For âRSSâ files,
the covariance matrix is determined in this case by calling
<a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_matrix" title="mangadap.drpfits.DRPFits.covariance_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_matrix()</span></code></a> on the âCUBEâ file, which will raise
an exception if the parameters defining the dimensions of the
reconstructed image and kernel are not the defaults.</p>
<p>In general, this function should <strong>not</strong> be used with âRSSâ
files for efficiency sake.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the spectral channel for which to
calculate the transfer matrix.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â Flag to recenter the coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â Number of pixels to use as buffer for
the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
<li><strong>sigma_rho</strong> (<em>float</em>) â The sigma of the Gaussian function used
to approximate the trend of the correlation coefficient
with pixel separation.</li>
<li><strong>csr</strong> (<em>bool</em>) â (<strong>Optional</strong>) Instead of reaturning a
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object,
return the covariance matrix as a
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a> object.  Primarily used by
<a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_cube" title="mangadap.drpfits.DRPFits.covariance_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_cube()</span></code></a> for collating the covariance
matrix of each wavelength channel before combining them
into a single
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> or
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a>: The covariance matrix for the
designated wavelength channel.  The return type depends on
<cite>csr</cite>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised for âCUBEâ files when the input
parameters are not the same as the defaults.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._covariance_wavelength">
<code class="descname">_covariance_wavelength</code><span class="sig-paren">(</span><em>waverange=None</em>, <em>response_func=None</em>, <em>per_pixel=True</em>, <em>flag=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._covariance_wavelength"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._covariance_wavelength" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Determine the wavelength at which to calculate the covariance
matrix.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>waverange</strong> (<em>array-like</em>) â (<strong>Optional</strong>) Starting and ending
wavelength over which to calculate the statistics.
Default is to use the full wavelength range.</li>
<li><strong>response_func</strong> (<em>array-like</em>) â (<strong>Optional</strong>) A two-column
array with the wavelength and transmission of a
broad-band response function to use for the calculation.</li>
<li><strong>per_pixel</strong> (<em>bool</em>) â (<strong>Optional</strong>) When providing a response
function, continue to calculate the statistics per
pixel, as opposed to per angstrom.  Default is to
compute the statistics on a per pixel basis.</li>
<li><strong>flag</strong> (<em>str</em><em> or </em><em>list</em>) â (<strong>Optional</strong>) (List of) Flag names that
are considered when deciding if a pixel should be
masked.  The names <em>must</em> be a valid bit name as defined
by <a class="reference internal" href="#mangadap.drpfits.DRPFits.bitmask" title="mangadap.drpfits.DRPFits.bitmask"><code class="xref py py-attr docutils literal notranslate"><span class="pre">bitmask</span></code></a> (see <a class="reference internal" href="#mangadap.drpfits.DRPFitsBitMask" title="mangadap.drpfits.DRPFitsBitMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFitsBitMask</span></code></a>).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The response-weighted center of the wavelength region
used to calculate the S/N, which will be where the
covariance matrix is calculated.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._cube_dimensions">
<code class="descname">_cube_dimensions</code><span class="sig-paren">(</span><em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>redo=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._cube_dimensions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._cube_dimensions" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Determine the on-sky dimensions of the reconstructed image for
all wavelength channels and save them in <code class="xref py py-attr docutils literal notranslate"><span class="pre">xs</span></code>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">ys</span></code>,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">nx</span></code>, and <code class="xref py py-attr docutils literal notranslate"><span class="pre">ny</span></code>.</p>
<p>For CUBE files, these dimensions are drawn directly from the WCS
keywords in the header of the FLUX extension of the DRP fits
file.  In this case, <strong>any entered parameters are ignored and
the class attributes are set to the default values used by the
DRP</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The calculation for the CUBE files is only valid if the WCS
coordinate system has no rotation.</p>
</div>
<p>For RSS files, the dimensions are determined using the data in
the âXPOSâ and âYPOSâ extensions and the same algorithm used by
the DRP; however, it is possible to provide different parameters
that will alter the dimensions.</p>
<p>See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.pixelscale" title="mangadap.drpfits.DRPFits.pixelscale"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pixelscale</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.recenter" title="mangadap.drpfits.DRPFits.recenter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">recenter</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.width_buffer" title="mangadap.drpfits.DRPFits.width_buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">width_buffer</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>redo</strong> (<em>bool</em>) â (<strong>Optional</strong>) Force the recalculation of the
cube dimensions if they are already defined.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._cube_dimensions_correct">
<code class="descname">_cube_dimensions_correct</code><span class="sig-paren">(</span><em>pixelscale</em>, <em>recenter</em>, <em>width_buffer</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._cube_dimensions_correct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._cube_dimensions_correct" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Check that the saved parameters that define the cube dimensions
are the same as the desired values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â Flag to recenter the coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â Number of pixels to use as buffer for
the image reconstruction</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if the saved and desired values are the same.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._cube_dimensions_undefined">
<code class="descname">_cube_dimensions_undefined</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._cube_dimensions_undefined"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._cube_dimensions_undefined" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return True if any of the cube dimensions are None.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._fix_header">
<code class="descname">_fix_header</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._fix_header"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._fix_header" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Use of âdegreesâ in early versions of the DRP did not adhere to
the fits standard causing the <a class="reference external" href="http://docs.astropy.org/en/v1.0.2/api/astropy.wcs.WCS.html">astropy.wcs.wcs.WCS</a> to fail
when initialized; see, e.g., <a class="reference internal" href="#mangadap.drpfits.DRPFits.world_mesh" title="mangadap.drpfits.DRPFits.world_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">world_mesh()</span></code></a>. This changes
the units to be âdegâ instead.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This function is <em>obsolete</em> as of v1_5_1 of the DRP and is
not actively called in this implementation; see source for
<a class="reference internal" href="#mangadap.drpfits.DRPFits.world_mesh" title="mangadap.drpfits.DRPFits.world_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">world_mesh()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._formal_covariance_matrix">
<code class="descname">_formal_covariance_matrix</code><span class="sig-paren">(</span><em>channel</em>, <em>pixelscale</em>, <em>recenter</em>, <em>width_buffer</em>, <em>rlim</em>, <em>sigma</em>, <em>csr=False</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._formal_covariance_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._formal_covariance_matrix" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the formal covariance matrix as defined by</p>
<div class="math notranslate nohighlight">
\[{\mathbf C} = {\mathbf T} \times {\mathbf \Sigma} \times
{\mathbf T}^{\rm T},\]</div>
<p>where <span class="math notranslate nohighlight">\({\mathbf \Sigma}\)</span> is the covariance matrix for the
âRSSâ spectra for the specified wavelength channel.  For âCUBEâ
files, the function will attempt to use the âRSSâ counterpart of
the file to produce the transfer matrix, <span class="math notranslate nohighlight">\({\mathbf T}\)</span>.
In this case, the input parameters <em>must</em> be the defaults.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The current DRP does not produce spectral covariance
matrices for the âRSSâ spectra.  Here, it is assumed that
the spectral covariance matrix is zero everywhere except
along the diagonal, which contains the inverse of the values
in the âIVARâ extension.</p>
</div>
<p>The use of this function should <strong>not</strong> be used with the âCUBEâ
files for efficiency sake.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the spectral channel for which to
calculate the transfer matrix.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â Flag to recenter the coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â Number of pixels to use as buffer for
the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
<li><strong>csr</strong> (<em>bool</em>) â (<strong>Optional</strong>) Instead of reaturning a
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object,
return the covariance matrix as a
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a> object.  Primarily used by
<a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_cube" title="mangadap.drpfits.DRPFits.covariance_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_cube()</span></code></a> for collating the covariance
matrix of each wavelength channel before combining them
into a single
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> or
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a>: The covariance matrix for the
designated wavelength channel.  The return type depends on
<em>csr</em>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised for âCUBEâ files when the input
parameters are not the same as the defaults.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._generate_spatial_index">
<code class="descname">_generate_spatial_index</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._generate_spatial_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._generate_spatial_index" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Generate the tuples with the list of original indices in the
input DRP file; see <a class="reference internal" href="#mangadap.drpfits.DRPFits.spatial_index" title="mangadap.drpfits.DRPFits.spatial_index"><code class="xref py py-attr docutils literal notranslate"><span class="pre">spatial_index</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._init_regrid_pars">
<code class="descname">_init_regrid_pars</code><span class="sig-paren">(</span><em>pixelscale</em>, <em>recenter</em>, <em>width_buffer</em>, <em>rlim</em>, <em>sigma</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._init_regrid_pars"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._init_regrid_pars" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the regridding parameters.  If provided on input, the
same value is returned.  Otherwise, the returned values are the
defaults.  See the defaults defined in
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_pixelscale" title="mangadap.config.defaults.default_cube_pixelscale"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_pixelscale()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_recenter" title="mangadap.config.defaults.default_cube_recenter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_recenter()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_width_buffer" title="mangadap.config.defaults.default_cube_width_buffer"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_width_buffer()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_regrid_rlim" title="mangadap.config.defaults.default_regrid_rlim"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_regrid_rlim()</span></code></a>, and
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_regrid_sigma" title="mangadap.config.defaults.default_regrid_sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_regrid_sigma()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â Flag to recenter the coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â Number of pixels to use as buffer for
the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The validated regridding
parameters in the same order as listed by the function
arguments.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float, bool, int, float, float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._interpolated_response_function">
<code class="descname">_interpolated_response_function</code><span class="sig-paren">(</span><em>response_func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._interpolated_response_function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._interpolated_response_function" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._regrid_defaults">
<code class="descname">_regrid_defaults</code><span class="sig-paren">(</span><em>pixelscale</em>, <em>recenter</em>, <em>width_buffer</em>, <em>rlim</em>, <em>sigma</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._regrid_defaults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._regrid_defaults" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Check that the saved regridding parameters are the same as the
defaults.  See
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_pixelscale" title="mangadap.config.defaults.default_cube_pixelscale"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_pixelscale()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_recenter" title="mangadap.config.defaults.default_cube_recenter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_recenter()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_width_buffer" title="mangadap.config.defaults.default_cube_width_buffer"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_width_buffer()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_regrid_rlim" title="mangadap.config.defaults.default_regrid_rlim"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_regrid_rlim()</span></code></a>, and
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_regrid_sigma" title="mangadap.config.defaults.default_regrid_sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_regrid_sigma()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â Flag to recenter the coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â Number of pixels to use as buffer for
the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if the saved and default values are the same.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._regrid_kernel_correct">
<code class="descname">_regrid_kernel_correct</code><span class="sig-paren">(</span><em>pixelscale</em>, <em>rlim</em>, <em>sigma</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._regrid_kernel_correct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._regrid_kernel_correct" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Check that the saved parameters used to define the image
reconstruction kernel are the same as the desired values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if the saved and desired values are the same.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._regrid_transfer_correct">
<code class="descname">_regrid_transfer_correct</code><span class="sig-paren">(</span><em>channel</em>, <em>pixelscale</em>, <em>rlim</em>, <em>sigma</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._regrid_transfer_correct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._regrid_transfer_correct" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Check that the saved parameters used to construct the transfer
matrix, <span class="math notranslate nohighlight">\({\mathbf T}\)</span>, are the same as the desired values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the wavelength channel to
reconstruct</li>
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if the saved and desired values are the same.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._regrid_transfer_undefined">
<code class="descname">_regrid_transfer_undefined</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._regrid_transfer_undefined"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._regrid_transfer_undefined" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return True if <a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_T" title="mangadap.drpfits.DRPFits.regrid_T"><code class="xref py py-attr docutils literal notranslate"><span class="pre">regrid_T</span></code></a> is None.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._set_spectral_arrays">
<code class="descname">_set_spectral_arrays</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._set_spectral_arrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._set_spectral_arrays" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Set the list of extensions with spectral data</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._set_variance_correlation">
<code class="descname">_set_variance_correlation</code><span class="sig-paren">(</span><em>sigma_rho</em>, <em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>rlim=None</em>, <em>sigma=None</em>, <em>redo=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._set_variance_correlation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._set_variance_correlation" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Produce <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a> based on the provided <em>sigma_rho</em>.</p>
<p>By default, the details of the cube dimensions should be the
same as the DRP used to produce the âCUBEâ files from the âRSSâ
spectra; however, these can be changed.</p>
<p>The resulting <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a> is independent of wavelength and
can be used in combination with the inverse-variance produced by
the DRP to yield a wavelength-dependent covariance matrix that
is close to the formal calculation.</p>
<p>See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a>, attr:<cite>sigma_rho</cite>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.pixelscale" title="mangadap.drpfits.DRPFits.pixelscale"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pixelscale</span></code></a>,
<a class="reference internal" href="#mangadap.drpfits.DRPFits.recenter" title="mangadap.drpfits.DRPFits.recenter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">recenter</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.width_buffer" title="mangadap.drpfits.DRPFits.width_buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">width_buffer</span></code></a>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">rlim</span></code>,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sigma</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>sigma</em> is not actually used by this function.</p>
</div>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Test the relation between <em>sigma</em>, <em>rlim</em>, and <em>sigma_rho</em>.
It may be that sigma_rho should/can be determined by sigma.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sigma_rho</strong> (<em>float</em>) â The sigma of the Gaussian function used
to approximate the trend of the correlation coefficient
with pixel separation.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â (<strong>Optional</strong>) The limiting radius of the
image reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the image
reconstruction kernel in arcseconds.</li>
<li><strong>redo</strong> (<em>bool</em>) â (<strong>Optional</strong>) Force the recalculation of the
cube dimensions if they are already defined.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._spectral_resolution_extension">
<code class="descname">_spectral_resolution_extension</code><span class="sig-paren">(</span><em>ext=None</em>, <em>pre=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._spectral_resolution_extension"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._spectral_resolution_extension" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Determine the spectral resolution channel to use.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._variance_correlation_correct">
<code class="descname">_variance_correlation_correct</code><span class="sig-paren">(</span><em>sigma_rho</em>, <em>pixelscale</em>, <em>rlim</em>, <em>sigma</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._variance_correlation_correct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._variance_correlation_correct" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Check that the saved parameters used to construct the
correlation coefficient matrix, <span class="math notranslate nohighlight">\({\mathbf R}\)</span>, are the
same as the desired values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sigma_rho</strong> (<em>float</em>) â The sigma of the Gaussian function used
to approximate the trend of the correlation coefficient
with pixel separation.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â Desired pixel scale in arcsec</li>
<li><strong>rlim</strong> (<em>float</em>) â The limiting radius of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â The sigma of the image reconstruction kernel
in arcseconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">True if the saved and desired values are the same.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits._variance_correlation_undefined">
<code class="descname">_variance_correlation_undefined</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits._variance_correlation_undefined"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits._variance_correlation_undefined" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return True if <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a> is None.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.binned_on_sky_area">
<code class="descname">binned_on_sky_area</code><span class="sig-paren">(</span><em>bin_indx</em>, <em>x=None</em>, <em>y=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.binned_on_sky_area"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.binned_on_sky_area" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Compute the on-sky area of a set of binned spectra.  For CUBE
files, this is just the number of spaxels in the bin times the
spaxel area (as given by <a class="reference internal" href="#mangadap.drpfits.DRPFits.pixelscale" title="mangadap.drpfits.DRPFits.pixelscale"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pixelscale</span></code></a>).</p>
<p>For RSS files, this will try to calculate the overlapping area
of the fibers using the <a class="reference external" href="https://pypi.python.org/pypi/Shapely">shapely</a> python package:</p>
<blockquote>
<div><ul class="simple">
<li>The fibers âbeamsâ are all renormalized to have an area of
pi arcsec^2 by the DRP, so itâs radius 1 arcsec</li>
<li>This function will provide the <em>total</em> area, not the
integration-weighted effective area.</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>bin_indx</strong> (<em>array-like</em>) â A vector with size <span class="math notranslate nohighlight">\(N_{\rm
spec}\)</span> the gives which spaxels or fibers were included
in each bin.  Valid bins have indices of <span class="math notranslate nohighlight">\(\geq 0\)</span>.</li>
<li><strong>x</strong> (<em>array-like</em>) â (<strong>Optional</strong>) On-sky <span class="math notranslate nohighlight">\(x\)</span> coordinate.
Default is to calculate <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> using
<a class="reference internal" href="#mangadap.drpfits.DRPFits.mean_sky_coordinates" title="mangadap.drpfits.DRPFits.mean_sky_coordinates"><code class="xref py py-func docutils literal notranslate"><span class="pre">mean_sky_coordinates()</span></code></a> with no arguments.</li>
<li><strong>y</strong> (<em>array-like</em>) â (<strong>Optional</strong>) On-sky <span class="math notranslate nohighlight">\(y\)</span> coordinate.
Default is to calculate <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> using
<a class="reference internal" href="#mangadap.drpfits.DRPFits.mean_sky_coordinates" title="mangadap.drpfits.DRPFits.mean_sky_coordinates"><code class="xref py py-func docutils literal notranslate"><span class="pre">mean_sky_coordinates()</span></code></a> with no arguments.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The on-sky area of each bin.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">numpy.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.drpfits.DRPFits.can_compute_covariance">
<code class="descname">can_compute_covariance</code><a class="headerlink" href="#mangadap.drpfits.DRPFits.can_compute_covariance" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="mangadap.drpfits.DRPFits.check_mode">
<em class="property">static </em><code class="descname">check_mode</code><span class="sig-paren">(</span><em>mode</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.check_mode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.check_mode" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Check that the mode is valid.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mode</strong> (<em>str</em>) â Mode value to check.  Valid modes are <cite>CUBE</cite> and</li>
<li><strong>RSS.</strong> â </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.copy_to_array">
<code class="descname">copy_to_array</code><span class="sig-paren">(</span><em>ext='FLUX'</em>, <em>waverange=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.copy_to_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.copy_to_array" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Wrapper for <a class="reference internal" href="mangadap.util.fitsutil.html#mangadap.util.fitsutil.DAPFitsUtil.copy_to_array" title="mangadap.util.fitsutil.DAPFitsUtil.copy_to_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.util.fitsutil.DAPFitsUtil.copy_to_array()</span></code></a>
specific for <a class="reference internal" href="#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFits</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.copy_to_masked_array">
<code class="descname">copy_to_masked_array</code><span class="sig-paren">(</span><em>ext='FLUX'</em>, <em>flag=None</em>, <em>waverange=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.copy_to_masked_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.copy_to_masked_array" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Wrapper for
<a class="reference internal" href="mangadap.util.fitsutil.html#mangadap.util.fitsutil.DAPFitsUtil.copy_to_masked_array" title="mangadap.util.fitsutil.DAPFitsUtil.copy_to_masked_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.util.fitsutil.DAPFitsUtil.copy_to_masked_array()</span></code></a>
specific for <a class="reference internal" href="#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFits</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.covariance_cube">
<code class="descname">covariance_cube</code><span class="sig-paren">(</span><em>channels=None</em>, <em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>rlim=None</em>, <em>sigma=None</em>, <em>sigma_rho=None</em>, <em>csr=False</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.covariance_cube"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.covariance_cube" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the covariance matrices for all wavelength channels; see
<a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_matrix" title="mangadap.drpfits.DRPFits.covariance_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_matrix()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â (<strong>Optional</strong>) The limiting radius of the
image reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma_rho</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the Gaussian
function used to approximate the trend of the
correlation coefficient with pixel separation.</li>
<li><strong>csr</strong> (<em>bool</em>) â (<strong>Optional</strong>) Instead of reaturning a
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object,
return a numpy.ndarray of the covariance matrices for
each channel, which are <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a>
objects.  Primarily used by <a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_cube" title="mangadap.drpfits.DRPFits.covariance_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_cube()</span></code></a> for
collating the covariance matrix of each wavelength
channel before combining them into a single
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> or
numpy.ndarray: The return type depends on <cite>csr</cite>: if True,
the returned object is an ndarray of
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a> types.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">Exception</span></code> â Raised for âCUBEâ files when the input parameters
are not the same as the defaults.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.covariance_matrix">
<code class="descname">covariance_matrix</code><span class="sig-paren">(</span><em>channel</em>, <em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>rlim=None</em>, <em>sigma=None</em>, <em>sigma_rho=None</em>, <em>csr=False</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.covariance_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.covariance_matrix" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the covariance matrix for the specified wavelength
channel.</p>
<p>For a regrided cube image with <span class="math notranslate nohighlight">\(N_x\times N_y\)</span> pixels, the
covariance matrix has a size that is <span class="math notranslate nohighlight">\((N_x N_y)\times (N_x
N_y)\)</span>; however, the majority of these pixels will be zero.
Therefore, the covariance matrix is stored as a sparse matrix
and interfaced with using the
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object class.</p>
<p>The value of the covariance matrix at pixel <span class="math notranslate nohighlight">\((i,j)\)</span> is the
covariance between pixels <span class="math notranslate nohighlight">\((n_{x,0},n_{y,0})\)</span> and
<span class="math notranslate nohighlight">\((n_{x,1},n_{y,1})\)</span> at the specified wavelength channel of
the reconstructed CUBE image, where</p>
<div class="math notranslate nohighlight">
\[\begin{split}n_{x,0} &amp;= \lfloor i / N_y \rfloor \\
n_{y,0} &amp;= i - n_{x,0} N_y \\
n_{x,1} &amp;= \lfloor j / N_y \rfloor \\
n_{y,1} &amp;= j - n_{x,1} N_y\end{split}\]</div>
<p>and <span class="math notranslate nohighlight">\(\lfloor m\rfloor\)</span> is the âfloorâ of <span class="math notranslate nohighlight">\(m\)</span>.  The
diagonal of the covariance matrix (<span class="math notranslate nohighlight">\(i=j\)</span>) should directly
provide the inverse of the IVAR values provided by the DRP.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">THIS IS IMPORTANT.  Because the sense of the pixel
coordinates, <span class="math notranslate nohighlight">\((n_x,n_y)\)</span>, is flipped with respect to a
direct read of the DRP fits file using <a class="reference external" href="http://docs.astropy.org/en/stable/io/fits/index.html">astropy.io.fits</a>,
it is important that you appreciate this ordering in
handling the coordinates in the output covariance matrix
using the equation above.  I.e., if you want to get the
covariance between two pixels in the DRP file, make sure you
understand which is the <span class="math notranslate nohighlight">\(x\)</span> pixel and which is the
<span class="math notranslate nohighlight">\(y\)</span> pixel!</p>
</div>
<p>You can compare the CUBE provide inverse variance matrix and the
inverse variance matrix provided along the diagonal of a
covariance matrix calculated using this function as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">mangadap.drpfits</span> <span class="k">import</span> <span class="n">DRPFits</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>

<span class="n">drpf</span> <span class="o">=</span> <span class="n">DRPFits</span><span class="p">(</span><span class="mi">7495</span><span class="p">,</span> <span class="mi">3701</span><span class="p">,</span> <span class="s1">&#39;CUBE&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">drpf</span><span class="o">.</span><span class="n">file_path</span><span class="p">())</span>
<span class="n">drpf</span> <span class="o">=</span> <span class="n">DRPFits</span><span class="p">(</span><span class="mi">7495</span><span class="p">,</span> <span class="mi">3701</span><span class="p">,</span> <span class="s1">&#39;RSS&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">channel</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">covariance_matrix</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

<span class="n">ivar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> \
                        <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">indx</span> <span class="o">=</span> <span class="n">ivar</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">ivar</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ivar</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
<span class="n">ivar</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">indx</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">pyplot</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ivar</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
          <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;regrid&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.86</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DRP&#39;</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;IVAR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">channel</span><span class="p">,:,:],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
               <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Differences between the inverse variance values should be small
(<span class="math notranslate nohighlight">\(\approx 10^{-3}\)</span>, which is about 1 part in
<span class="math notranslate nohighlight">\(10^7\)</span>).</p>
<p>The covariance matrix can be generated in one of two ways:</p>
<p>1. If <em>sigma_rho</em> is None, the returned matrix is the formal
covariance matrix defined as</p>
<div class="math notranslate nohighlight">
\[{\mathbf C} = {\mathbf T} \times {\mathbf \Sigma} \times
{\mathbf T}^{\rm T},\]</div>
<p>where <span class="math notranslate nohighlight">\({\mathbf \Sigma}\)</span> is the covariance matrix for the
âRSSâ spectra for the specified wavelength channel.  For âCUBEâ
files, the function will attempt to use the âRSSâ counterpart of
the file to produce the transfer matrix, <span class="math notranslate nohighlight">\({\mathbf T}\)</span>.
In this case, the input parameters <em>must</em> be the defaults.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The current DRP does not produce spectral covariance
matrices for the âRSSâ spectra.  Here, it is assumed that
the spectral covariance matrix is zero everywhere except
along the diagonal, which contains the inverse of the values
in the âIVARâ extension.</p>
</div>
<p>2. If <em>sigma_rho</em> is not None, the returned matrix is an
approximation of the covariance matrix determined by
<em>sigma_rho</em>.  See the description of <a class="reference internal" href="#mangadap.drpfits.DRPFits.cov_rho" title="mangadap.drpfits.DRPFits.cov_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cov_rho</span></code></a> and
<a class="reference internal" href="#mangadap.drpfits.DRPFits.sigma_rho" title="mangadap.drpfits.DRPFits.sigma_rho"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sigma_rho</span></code></a>.  For this to work, the variance matrix of the
reconstructed image must have been already calculated, meaning
that this approach is most appropriately used with the âCUBEâ
files.  For âRSSâ files, the covariance matrix is determined in
this case by calling <a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_matrix" title="mangadap.drpfits.DRPFits.covariance_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_matrix()</span></code></a> on the âCUBEâ
file, which will raise an exception if the parameters defining
the dimensions of the reconstructed image and kernel are not the
defaults.</p>
<p>In general, use of <em>sigma_rho</em> should <strong>not</strong> be used with âRSSâ
files and the use of the formal calculation should <strong>not</strong> be
used with the âCUBEâ files for efficiency.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the spectral channel for which
to calculate the transfer matrix.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â (<strong>Optional</strong>) The limiting radius of the
image reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the image
reconstruction kernel in arcseconds.</li>
<li><strong>sigma_rho</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the Gaussian
function used to approximate the trend of the
correlation coefficient with pixel separation.</li>
<li><strong>csr</strong> (<em>bool</em>) â (<strong>Optional</strong>) Instead of reaturning a
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object,
return the covariance matrix as a
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a> object.  Primarily used by
<a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_cube" title="mangadap.drpfits.DRPFits.covariance_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_cube()</span></code></a> for collating the covariance
matrix of each wavelength channel before combining them
into a single
<a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> object</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><a class="reference internal" href="mangadap.util.covariance.html#mangadap.util.covariance.Covariance" title="mangadap.util.covariance.Covariance"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.covariance.Covariance</span></code></a> or
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a>: The covariance matrix for the
designated wavelength channel.  The return type depends on
<cite>csr</cite>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised for âCUBEâ files when the input
parameters are not the same as the defaults.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">Need to make sure that the correct masks are being used for
the RSS files.  Should be 3DREJECT but nothing else?</p>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.created_today">
<code class="descname">created_today</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.created_today"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.created_today" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return True if the file was created today based on its time
stamp.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Intended for use at the survey-level for a daily run of the
DAP.  Likely not to be used though.</p>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="mangadap.drpfits.DRPFits.default_paths">
<em class="property">static </em><code class="descname">default_paths</code><span class="sig-paren">(</span><em>plate</em>, <em>ifudesign</em>, <em>mode</em>, <em>drpver=None</em>, <em>redux_path=None</em>, <em>directory_path=None</em>, <em>output_file=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.default_paths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.default_paths" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the primary directory and file name with the DRP fits
LOG-binned file.</p>
<blockquote>
<div><p>plate (int): Plate number of the observation.
ifudesign (int): IFU design number of the observation.
mode (str): 3D mode of the DRP file; must be either âRSSâ or</p>
<blockquote>
<div>âCUBEâ</div></blockquote>
<dl class="docutils">
<dt>drpver (str): (<strong>Optional</strong>) DRP version.  Default set by</dt>
<dd><a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_drp_version" title="mangadap.config.defaults.default_drp_version"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_drp_version()</span></code></a>.</dd>
<dt>redux_path (str): (<strong>Optional</strong>) The path to the top level</dt>
<dd>directory containing the DRP output files for a given
DRP version.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_redux_path" title="mangadap.config.defaults.default_redux_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_redux_path()</span></code></a>.</dd>
<dt>directory_path (str): (<strong>Optional</strong>) The exact path to the</dt>
<dd>DAP reduction assessments file.  Default set by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_common_path" title="mangadap.config.defaults.default_dap_common_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_dap_common_path()</span></code></a>.</dd>
<dt>output_file (str): (<strong>Optional</strong>) The name of the file with</dt>
<dd>the DRP data.  Default set by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_manga_fits_root" title="mangadap.config.defaults.default_manga_fits_root"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_manga_fits_root()</span></code></a>.</dd>
</dl>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Two strings with the path to and name of the DRP data
file.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="mangadap.drpfits.DRPFits.do_not_fit_flags">
<em class="property">static </em><code class="descname">do_not_fit_flags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.do_not_fit_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.do_not_fit_flags" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the maskbit names that should not be fit.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="mangadap.drpfits.DRPFits.do_not_stack_flags">
<em class="property">static </em><code class="descname">do_not_stack_flags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.do_not_stack_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.do_not_stack_flags" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the maskbit names that should not be stacked.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.file_name">
<code class="descname">file_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.file_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.file_name" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the name of the DRP file</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.file_path">
<code class="descname">file_path</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.file_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.file_path" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the full path to the DRP file</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.finding_chart_path">
<code class="descname">finding_chart_path</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.finding_chart_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.finding_chart_path" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the full path to the PNG finding chart for the targetted
object.</p>
<div class="admonition-todo admonition" id="index-3">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Move this to the defaults file?</li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.flux_stats">
<code class="descname">flux_stats</code><span class="sig-paren">(</span><em>waverange=None</em>, <em>response_func=None</em>, <em>per_pixel=True</em>, <em>flag=None</em>, <em>covar=False</em>, <em>correlation=False</em>, <em>covar_wave=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.flux_stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.flux_stats" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Compute the mean flux, propagated error in the mean flux, and
mean S/N over the specified wavelength range; if the wavelength
range is not specified, the quantities are calculated over the
full spectral range.</p>
<p>If an RSS file, no covariance is calculated.</p>
<p>If a CUBE file and covar is True, the code will calculate the
covariance matrix at the specified wavelength (see
<a class="reference internal" href="#mangadap.drpfits.DRPFits.covariance_matrix" title="mangadap.drpfits.DRPFits.covariance_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance_matrix()</span></code></a>).  If covar_wave is not provided, the
covariance is calculated at the center wavelength of the
provided wavelength range.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>waverange</strong> (<em>array-like</em>) â (<strong>Optional</strong>) Starting and ending
wavelength over which to calculate the statistics.
Default is to use the full wavelength range.</li>
<li><strong>response_func</strong> (<em>array-like</em>) â (<strong>Optional</strong>) A two-column
array with the wavelength and transmission of a
broad-band response function to use for the calculation.</li>
<li><strong>per_pixel</strong> (<em>bool</em>) â (<strong>Optional</strong>) When providing a response
function, continue to calculate the statistics per
pixel, as opposed to per angstrom.  Default is to
compute the statistics on a per pixel basis.</li>
<li><strong>flag</strong> (<em>str</em><em> or </em><em>list</em>) â (<strong>Optional</strong>) (List of) Flag names that
are considered when deciding if a pixel should be
masked.  The names <em>must</em> be a valid bit name as defined
by <a class="reference internal" href="#mangadap.drpfits.DRPFits.bitmask" title="mangadap.drpfits.DRPFits.bitmask"><code class="xref py py-attr docutils literal notranslate"><span class="pre">bitmask</span></code></a> (see <a class="reference internal" href="#mangadap.drpfits.DRPFitsBitMask" title="mangadap.drpfits.DRPFitsBitMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFitsBitMask</span></code></a>).</li>
<li><strong>covar</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to calculate covariance
matrix.</li>
<li><strong>correlation</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to convert the
covariance matrix to a correlation matrix on ouput.</li>
<li><strong>covar_wave</strong> (<em>double</em>) â (<strong>Optional</strong>) Wavelength to use for
the covariance calculation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Four objects are returned: the mean flux, the
propagated variance in the mean flux, the mean S/N, and the
covariance/correlation matrix for a single wavelength
channel.  If the object is an RSS file or no covariance
calculation is requested, the last returned object is None.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">numpy.ndarray</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised of a provided wavelength range object
does not have two elements.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="mangadap.drpfits.DRPFits.from_file">
<em class="property">classmethod </em><code class="descname">from_file</code><span class="sig-paren">(</span><em>input_file</em>, <em>plate=0</em>, <em>ifudesign=0</em>, <em>read=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.from_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.from_file" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Function to read a DRP-like data cube.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Work in progress.  Currently does not work.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.info">
<code class="descname">info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.info" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Print the HDU info page.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.instrumental_dispersion_plane">
<code class="descname">instrumental_dispersion_plane</code><span class="sig-paren">(</span><em>channel</em>, <em>dispersion_factor=None</em>, <em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>rlim=None</em>, <em>sigma=None</em>, <em>pre=False</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.instrumental_dispersion_plane"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.instrumental_dispersion_plane" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the instrumental dispersion for the reconstructed âCUBEâ
wavelength plane.</p>
<p>For âCUBEâ files, the input parameters <em>must</em> be the same as the
defaults.  If they are, the function must be able to find and
access the âRSSâ file to construct the instrumental dispersion
map because the necessary information is not in the âCUBEâ
files (before MPL-6).</p>
<div class="admonition-todo admonition" id="index-4">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Need to implement something that will recognize that the
âDISPâ extension exists in the MPL-6 and later DRP CUBE
files.</li>
</ul>
</div>
<p>For âRSSâ files, the transfer matrix, <span class="math notranslate nohighlight">\({\mathbf T}\)</span>, is
first calculated using <a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_transfer_matrix" title="mangadap.drpfits.DRPFits.regrid_transfer_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">regrid_transfer_matrix()</span></code></a>.  The
transfer matrix is used to construct the âCUBEâ wavelength plane
image, <span class="math notranslate nohighlight">\({\mathbf I}\)</span>, by computing <span class="math notranslate nohighlight">\({\mathbf T}
\times {\mathbf F} = {\mathbf I}\)</span>, where <span class="math notranslate nohighlight">\({\mathbf F}\)</span> is
the vector of the fiber fluxes.  Under the assumption that the
line-spread-function (LSF) is Gaussian, we determine the
instrumental dispersion for the data in the wavelength channel
of the reconstructed CUBE by calculating the second moment of
the weighted sum of Gaussians of the appropriate dispersion.
Assuming all the Gaussians have the normalized form:</p>
<div class="math notranslate nohighlight">
\[\mathcal{N}(x|\mu=0,\sigma) = \frac{1}{\sqrt{2\pi}\sigma}
\exp\left(-\frac{x^2}{2\sigma^2}\right),\]</div>
<p>the combined instrumental dispersion becomes</p>
<div class="math notranslate nohighlight">
\[\sigma_{\rm inst,j}^2 = \frac{\sum_i T_{ij}
\sigma^2_i}{\sum_i T_{ij}},\]</div>
<p>where <span class="math notranslate nohighlight">\(T_{ij}\)</span> are the elements of the transfer matrix.
In terms of matrix multiplications, this can be written as</p>
<div class="math notranslate nohighlight">
\[{\mathbf S} = \frac{ {\mathbf T} \times {\mathbf V} }{
{\mathbf T_c} },\]</div>
<p>where <span class="math notranslate nohighlight">\({\mathbf T_c} = {\mathbf T_c} \times {\mathbf 1}\)</span>
is the vector with the sum <span class="math notranslate nohighlight">\(\sum_j T_{ij}\)</span>,
<span class="math notranslate nohighlight">\({\mathbf V}\)</span> is the instrumental variance for all fibers
at the designated wavelength plane, and <span class="math notranslate nohighlight">\({\mathbf S}\)</span> is
the variance for all the spaxels in the reconstructed wavelength
image; the division by <span class="math notranslate nohighlight">\({\mathbf T_c}\)</span> is element-wise.</p>
<p>The returned matrix is the element-wise square-root of
<span class="math notranslate nohighlight">\({\mathbf S}\)</span>, rearranged into a 2D array of size
<code class="xref py py-attr docutils literal notranslate"><span class="pre">ny</span></code> by <code class="xref py py-attr docutils literal notranslate"><span class="pre">nx</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Because the internal data structure is transposed with
respect to the DRP file, the result is transposed on output
so that it will match the pixel coordinates in the
reconstructed image pulled directly from a DRP file.  See
<code class="xref py py-func docutils literal notranslate"><span class="pre">regrid_wavelength_channel()</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the spectral channel for which to
calculate the transfer matrix.</li>
<li><strong>dispersion_factor</strong> (<em>float</em>) â (<strong>Optional</strong>) Artificially
multiply the dispersion measurements by this factor
before calculating the reconstructed dispersion.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â (<strong>Optional</strong>) The limiting radius of the
image reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the image
reconstruction kernel in arcseconds.</li>
<li><strong>pre</strong> (<em>bool</em>) â (<strong>Optional</strong>) Read the pre-pixelized version of
the spectral resolution, instead of the post-pixelized
version.  This prepends âPREâ to the extension name.</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The reconstructed image for the specified
wavelength channel.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">numpy.ndarray</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised for âCUBEâ files when the input parameters
are not the same as the defaults.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.mean_sky_coordinates">
<code class="descname">mean_sky_coordinates</code><span class="sig-paren">(</span><em>waverange=None</em>, <em>response_func=None</em>, <em>per_pixel=True</em>, <em>offset=True</em>, <em>flag=None</em>, <em>fluxwgt=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.mean_sky_coordinates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.mean_sky_coordinates" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Compute the mean sky coordinates for each spectrum.</p>
<p>For CUBE files, this just returns the spaxel coordinates in
arcseconds relative to the object center, where the object
center is <span class="math notranslate nohighlight">\((\alpha_0,\delta_0) = ({\rm OBJRA},{\rm
OBJDEC)\)</span> as provided in the primary header, and</p>
<div class="math notranslate nohighlight">
\[\begin{split}x &amp;= (\alpha - \alpha_0) \cos \delta_0 \\
y &amp;= (\delta - \delta_0)\end{split}\]</div>
<p>The coordinate grid, <span class="math notranslate nohighlight">\((\alpha, \delta)\)</span> is based on the
WCS coordinates in the header as returned by <a class="reference internal" href="#mangadap.drpfits.DRPFits.world_mesh" title="mangadap.drpfits.DRPFits.world_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">world_mesh()</span></code></a>.</p>
<p>For RSS files, this returns either the unweighted or
flux-weighted XPOS and YPOS values.  For observations where the
pointing center is different from the object center, the
returned coordinates are relative to the object center if
offset=True (default) and relative to the pointing center if
offset=False.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Flux-weighting the coordinates can produce spurious results
in low-flux regimes.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>waverange</strong> (<em>array-like</em>) â (<strong>Optional</strong>) Two-element array
with the first and last wavelength to include in the
computation.  Default is to use the full wavelength
range.</li>
<li><strong>response_func</strong> (<em>array-like</em>) â (<strong>Optional</strong>) A two-column
array with the wavelength and transmission of a
broad-band response function to use for the calculation.</li>
<li><strong>per_pixel</strong> (<em>bool</em>) â (<strong>Optional</strong>) When providing a response
function, continue to calculate the statistics per
pixel, as opposed to per angstrom.  Default is to</li>
<li><strong>offset</strong> (<em>bool</em>) â Offset the coordinates to the object
coordinates.</li>
<li><strong>flag</strong> (<em>str</em><em> or </em><em>list</em>) â (<strong>Optional</strong>) (List of) Flag names that
are considered when deciding if a pixel should be
masked.  The names <em>must</em> be a valid bit name as defined
by <a class="reference internal" href="#mangadap.drpfits.DRPFits.bitmask" title="mangadap.drpfits.DRPFits.bitmask"><code class="xref py py-attr docutils literal notranslate"><span class="pre">bitmask</span></code></a> (see <a class="reference internal" href="#mangadap.drpfits.DRPFitsBitMask" title="mangadap.drpfits.DRPFitsBitMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFitsBitMask</span></code></a>).</li>
<li><strong>fluxwgt</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to weight by the flux
when determining the mean coordinates for the RSS spectra.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A 1D array with the coordinates of each
spectrum.  The index of the vector matches the index in
<a class="reference internal" href="#mangadap.drpfits.DRPFits.spatial_index" title="mangadap.drpfits.DRPFits.spatial_index"><code class="xref py py-attr docutils literal notranslate"><span class="pre">spatial_index</span></code></a> in case you want to recreate the a map
for the CUBE files.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">numpy.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="mangadap.drpfits.DRPFits.mode_options">
<em class="property">static </em><code class="descname">mode_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.mode_options"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.mode_options" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the allowed modes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">List of the allowed DRP fits file modes.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.object_coo">
<code class="descname">object_coo</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.object_coo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.object_coo" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the object right ascension (âOBJRAâ) and declination
(âOBJDECâ) taken from the DRP file <em>primary</em> header.  The
HDUList is opened if hasnât been already.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Object RA and DEC in degrees.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.object_data">
<code class="descname">object_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.object_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.object_data" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the MaNGA ID (âMANGAIDâ), object right ascension
(âOBJRAâ), and object declination (âOBJDECâ) taken from the DRP
file <em>primary</em> header.  The HDUList is opened if hasnât been
already.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">MaNGA ID and object RA and DEC.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">str, float, float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.open_hdu">
<code class="descname">open_hdu</code><span class="sig-paren">(</span><em>checksum=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.open_hdu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.open_hdu" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Read the fits file.</p>
<p>For security purposes, the fits file is <em>always</em> opened as read
only.  If <a class="reference internal" href="#mangadap.drpfits.DRPFits.hdu" title="mangadap.drpfits.DRPFits.hdu"><code class="xref py py-attr docutils literal notranslate"><span class="pre">hdu</span></code></a> is not None, this function assumes the
data has already been read and returns to the calling process.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>checksum</strong> (<em>bool</em>) â (<strong>Optional</strong>) Check for file corruption.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FileNotFoundError</span></code> â Raised if the DRP file does not exist.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.pix_mesh">
<code class="descname">pix_mesh</code><span class="sig-paren">(</span><em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>extent=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.pix_mesh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.pix_mesh" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Uses <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.meshgrid.html">numpy.meshgrid</a> to create and return the I and J <em>pixel</em>
coordinates for an nx*ny mesh.</p>
<p>For CUBE files, these dimensions are drawn directly from the WCS
keywords in the header of the FLUX extension of the DRP fits
file.  In this case, <strong>any entered parameters are ignored and
the class attributes are set to the default values used by the
DRP</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The calculation for the CUBE files is only valid if the WCS
coordinate system has no rotation.</p>
</div>
<p>For RSS files, the dimensions are determined using the data in
the âXPOSâ and âYPOSâ extensions and the same algorithm used by
the DRP; however, it is possible to provide different parameters
that will alter the dimensions.</p>
<p>If <em>extent</em> is True, the returned mesh is of the pixel <em>edges</em>.
That is, for a grid of size <span class="math notranslate nohighlight">\(N\)</span>, there are <span class="math notranslate nohighlight">\(N\)</span> pixel
centers that run from 1 to <span class="math notranslate nohighlight">\(N\)</span>; however, there are
<span class="math notranslate nohighlight">\(N+1\)</span> pixel edges that run from from <span class="math notranslate nohighlight">\(0.5\)</span> to
<span class="math notranslate nohighlight">\(N+0.5\)</span>.</p>
<p>See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.pixelscale" title="mangadap.drpfits.DRPFits.pixelscale"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pixelscale</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.recenter" title="mangadap.drpfits.DRPFits.recenter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">recenter</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.width_buffer" title="mangadap.drpfits.DRPFits.width_buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">width_buffer</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>extent</strong> (<em>bool</em>) â (<strong>Optional</strong>) Return a grid of the pixel
<em>edges</em> instead of the coordinates of the pixel centers.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Two arrays with the pixel indices;
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.meshgrid.html">numpy.meshgrid</a> is run using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span>
</pre></div>
</div>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">numpy.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.pix_mesh_range">
<code class="descname">pix_mesh_range</code><span class="sig-paren">(</span><em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.pix_mesh_range"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.pix_mesh_range" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the range in x and y of the reconstructed image pixels,
including the size of the pixel.  Coordinate <span class="math notranslate nohighlight">\((1,1)\)</span> is
the center of the first pixel, so its bottom corner is at
<span class="math notranslate nohighlight">\((0.5,0.5)\)</span>.</p>
<p>For CUBE files, these dimensions are drawn directly from the WCS
keywords in the header of the FLUX extension of the DRP fits
file.  In this case, <strong>any entered parameters are ignored and
the class attributes are set to the default values used by the
DRP</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The calculation for the CUBE files is only valid if the WCS
coordinate system has no rotation.</p>
</div>
<p>For RSS files, the dimensions are determined using the data in
the âXPOSâ and âYPOSâ extensions and the same algorithm used by
the DRP; however, it is possible to provide different parameters
that will alter the dimensions.</p>
<p>See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.pixelscale" title="mangadap.drpfits.DRPFits.pixelscale"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pixelscale</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.recenter" title="mangadap.drpfits.DRPFits.recenter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">recenter</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.width_buffer" title="mangadap.drpfits.DRPFits.width_buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">width_buffer</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Two arrays with, respectively, the lower and
upper x range and the lower and upper y range.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">numpy.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.pointing_offset">
<code class="descname">pointing_offset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.pointing_offset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.pointing_offset" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the offsets in RA and DEC between the pointing
coordinates (IFURA, IFUDEC) and the designated object center
coordinates (OBJRA, OBJDEC), drawn from the primary header of
the DRP fits file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Sky-right arcsecond offsets in RA and DEC.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.regrid_transfer_matrix">
<code class="descname">regrid_transfer_matrix</code><span class="sig-paren">(</span><em>channel</em>, <em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>rlim=None</em>, <em>sigma=None</em>, <em>quiet=False</em>, <em>rej_flag='3DREJECT'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.regrid_transfer_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.regrid_transfer_matrix" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Calculate the transfer matrix used to produce a reconstructed
image of the fiber data at the specified wavelength channel.
See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_T" title="mangadap.drpfits.DRPFits.regrid_T"><code class="xref py py-attr docutils literal notranslate"><span class="pre">regrid_T</span></code></a>.</p>
<p>For âRSSâ files, this is done directly using the available
on-sky x and y coordinates of each fiber as a function of
wavelength taken from the âXPOSâ and âYPOSâ extensions.</p>
<p>For âCUBEâ files, the function will attempt to use the âRSSâ
counterpart of the file to produce transfer matrix.  In this
case, the input parameters <em>must</em> be the defaults.</p>
<p>The default behavior is to use the same parameters as used by
the DRP.  For the defaults, see
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_pixelscale" title="mangadap.config.defaults.default_cube_pixelscale"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_pixelscale()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_recenter" title="mangadap.config.defaults.default_cube_recenter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_recenter()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_cube_width_buffer" title="mangadap.config.defaults.default_cube_width_buffer"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_cube_width_buffer()</span></code></a>,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_regrid_rlim" title="mangadap.config.defaults.default_regrid_rlim"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_regrid_rlim()</span></code></a>, and
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_regrid_sigma" title="mangadap.config.defaults.default_regrid_sigma"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_regrid_sigma()</span></code></a>.  However,
the code allows the parameters to be freely chosen by the user.</p>
<p>See: <a class="reference internal" href="#mangadap.drpfits.DRPFits.pixelscale" title="mangadap.drpfits.DRPFits.pixelscale"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pixelscale</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.recenter" title="mangadap.drpfits.DRPFits.recenter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">recenter</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.width_buffer" title="mangadap.drpfits.DRPFits.width_buffer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">width_buffer</span></code></a>,
<a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_rlim" title="mangadap.drpfits.DRPFits.regrid_rlim"><code class="xref py py-attr docutils literal notranslate"><span class="pre">regrid_rlim</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_sigma" title="mangadap.drpfits.DRPFits.regrid_sigma"><code class="xref py py-attr docutils literal notranslate"><span class="pre">regrid_sigma</span></code></a>, <a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_T" title="mangadap.drpfits.DRPFits.regrid_T"><code class="xref py py-attr docutils literal notranslate"><span class="pre">regrid_T</span></code></a>.</p>
<div class="admonition-todo admonition" id="index-5">
<p class="first admonition-title">Todo</p>
<ul class="last">
<li><p class="first">Give more detail on the pixels at which the radius is
calculated.</p>
</li>
<li><p class="first">The details of this calculation need to be checked against
what is done by the DRP:</p>
<blockquote>
<div><ul class="simple">
<li>Are the positions in XPOS sky-right in the sense that
positive XPOS is toward positive RA or not?</li>
<li>Does the DRP rebin the data using a kernel that
defines the coordinate of a pixel at the pixel center
or at the pixel edge?</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The internal data structure of the RSS data is not different
from simply reading the fits file using <a class="reference external" href="http://docs.astropy.org/en/stable/io/fits/index.html">astropy.io.fits</a>.
This means you can use this function and apply the result to
a separate read of the RSS file (not that you would ever
want to do that).  But after doing that, the output will be
transposed wrt the CUBE file spatial orientation!  See
<a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_wavelength_plane" title="mangadap.drpfits.DRPFits.regrid_wavelength_plane"><code class="xref py py-func docutils literal notranslate"><span class="pre">regrid_wavelength_plane()</span></code></a>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the spectral channel for which
to calculate the transfer matrix.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â (<strong>Optional</strong>) The limiting radius of the
image reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the image
reconstruction kernel in arcseconds.</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Transfer matrix <span class="math notranslate nohighlight">\({\mathbf
T}\)</span></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first"><a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html">scipy.sparse.csr_matrix</a></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised for âCUBEâ files if the input parameters
are not the defaults.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.regrid_wavelength_plane">
<code class="descname">regrid_wavelength_plane</code><span class="sig-paren">(</span><em>channel</em>, <em>pixelscale=None</em>, <em>recenter=None</em>, <em>width_buffer=None</em>, <em>rlim=None</em>, <em>sigma=None</em>, <em>quiet=False</em>, <em>return_ivar=False</em>, <em>return_covar=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.regrid_wavelength_plane"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.regrid_wavelength_plane" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the reconstructed image for the specified wavelength
channel.</p>
<p>For âCUBEâ files, the input parameters <em>must</em> be the same as the
defaults.  If they are, the function simply returns the selected
2D array from the âFLUXâ extension.</p>
<p>For âRSSâ files, the transfer matrix is first calculated using
<a class="reference internal" href="#mangadap.drpfits.DRPFits.regrid_transfer_matrix" title="mangadap.drpfits.DRPFits.regrid_transfer_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">regrid_transfer_matrix()</span></code></a> and then used to calculate:</p>
<div class="math notranslate nohighlight">
\[{\mathbf T} \times {\mathbf F} = {\mathbf I}\]</div>
<p>where <span class="math notranslate nohighlight">\({\mathbf F}\)</span> is the vector of fluxes in the
selected wavelength channel for all the fiber measurements in
the field of view and <span class="math notranslate nohighlight">\({\mathbf I}\)</span> is the pre-formatted
(flattened) reconstructed image of that wavelength channel.</p>
<p><strong>On output, :math:`{mathbf I}` is rearranged into a 2D array
of size :attr:`nx` by :attr:`ny`.</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Because the internal data structure is transposed with
respect to the DRP file, the result is transposed on output
so that it will match the similar operation done directly on
a DRP file.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>int</em>) â Index of the spectral channel for which
to calculate the transfer matrix.</li>
<li><strong>pixelscale</strong> (<em>float</em>) â (<strong>Optional</strong>) Desired pixel scale in
arcsec</li>
<li><strong>recenter</strong> (<em>bool</em>) â (<strong>Optional</strong>) Flag to recenter the
coordinate system</li>
<li><strong>width_buffer</strong> (<em>int</em>) â (<strong>Optional</strong>) Number of pixels to use
as buffer for the image reconstruction</li>
<li><strong>rlim</strong> (<em>float</em>) â (<strong>Optional</strong>) The limiting radius of the
image reconstruction kernel in arcseconds.</li>
<li><strong>sigma</strong> (<em>float</em>) â (<strong>Optional</strong>) The sigma of the image
reconstruction kernel in arcseconds.</li>
<li><strong>quiet</strong> (<em>bool</em>) â (<strong>Optional</strong>) Suppress terminal output</li>
<li><strong>return_ivar</strong> (<em>bool</em>) â (<strong>Optional</strong>) Return the nominal
inverse variance image (i.e. the diagonal of the
covariance matrix).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The reconstructed image for the specified
wavelength channel.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">numpy.ndarray</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">Exception</span></code> â Raised for âCUBEâ files when the input parameters
are not the same as the defaults.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="mangadap.drpfits.DRPFits.sampling_options">
<em class="property">static </em><code class="descname">sampling_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.sampling_options"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.sampling_options" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the allowed wavelength sampling modes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">List of the allowed DRP fits wavelength sampling
modes.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.select">
<code class="descname">select</code><span class="sig-paren">(</span><em>t</em>, <em>ext='FLUX'</em>, <em>order='xy'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.select"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.select" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Select a specific vector from the fits data arrays.  The spatial
position within the original file accessed by index <code class="docutils literal notranslate"><span class="pre">i</span></code> is
given by <a class="reference internal" href="#mangadap.drpfits.DRPFits.spatial_index" title="mangadap.drpfits.DRPFits.spatial_index"><code class="xref py py-attr docutils literal notranslate"><span class="pre">spatial_index</span></code></a>.  For CUBE files this is a tuple
with the relevant pixel indices from the original DRP file.
This function is setup such that, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mangadap.drpfits</span> <span class="k">import</span> <span class="n">DRPFits</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">drpf</span> <span class="o">=</span> <span class="n">DRPFits</span><span class="p">(</span><span class="mi">7495</span><span class="p">,</span> <span class="mi">1901</span><span class="p">,</span> <span class="s1">&#39;CUBE&#39;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">drpf</span><span class="o">.</span><span class="n">file_path</span><span class="p">())</span>

<span class="c1"># should be no difference</span>
<span class="n">flux_direct</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
<span class="n">flux_class</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;yx&#39;</span> <span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">flux_direct</span> <span class="o">-</span> <span class="n">flux_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">),</span> \
    <span class="s1">&#39;Selection error!&#39;</span>

<span class="c1"># Or to use more natural x y order</span>
<span class="n">flux_class</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">flux_direct</span> <span class="o">-</span> <span class="n">flux_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">),</span> \
    <span class="s1">&#39;Selection error!&#39;</span>

<span class="c1"># Or select the spectrum based on its index</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">drpf</span><span class="o">.</span><span class="n">spatial_index</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
        <span class="k">break</span>
<span class="n">flux_class</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">flux_direct</span> <span class="o">-</span> <span class="n">flux_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">),</span> \
    <span class="s1">&#39;Selection error!&#39;</span>

<span class="c1"># Or use index and the provided spatial_index tuple</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">550</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">spatial_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">flux_direct</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">flux_class</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">flux_direct</span> <span class="o">-</span> <span class="n">flux_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">),</span> \
    <span class="s1">&#39;Selection error!&#39;</span>

<span class="n">flux_class</span> <span class="o">=</span> <span class="n">drpf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">flux_direct</span> <span class="o">-</span> <span class="n">flux_class</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">),</span> \
    <span class="s1">&#39;Selection error!&#39;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>t</strong> (<em>tuple</em><em> or </em><em>int</em>) â If an integer, this is the flattened
index of the spectrum to return.  If a tuple, this is
the position <em>within the original DRP file</em> for the
non-spectral axes.  See the examples above.</li>
<li><strong>ext</strong> (<em>str</em>) â (<strong>Optional</strong>) Name of the extension from which
to draw the data.  Must be allowed for the current
<a class="reference internal" href="#mangadap.drpfits.DRPFits.mode" title="mangadap.drpfits.DRPFits.mode"><code class="xref py py-attr docutils literal notranslate"><span class="pre">mode</span></code></a>; see <a class="reference internal" href="#mangadap.drpfits.DRPFits.spectral_arrays" title="mangadap.drpfits.DRPFits.spectral_arrays"><code class="xref py py-attr docutils literal notranslate"><span class="pre">spectral_arrays</span></code></a>.  Default is
<code class="docutils literal notranslate"><span class="pre">'FLUX'</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Vector with the data values as a function of
wavelength.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">numpy.ndarray</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code> â Raised if the selected extension cannot be used.</li>
<li><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised if the input selection object is not an
int or a tuple.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-6">
<p class="first admonition-title">Todo</p>
<p class="last">Add select_near function that uses on-sky coordinates.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.spectral_resolution">
<code class="descname">spectral_resolution</code><span class="sig-paren">(</span><em>ext=None</em>, <em>toarray=False</em>, <em>fill=False</em>, <em>pre=False</em>, <em>median=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.spectral_resolution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.spectral_resolution" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the spectral resolution at each spatial and spectral
position.</p>
<p>Select the extension âDISPâ or âSPECRESâ.  To get the
pre-pixelized versions, set pre=True.  If you set the extension
to âPREDISPâ and pre=True, it will try to find the extension
âPREPREDISPâ and fault.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ext</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, optional) â Specify the extension with the spectral estimate to use.
Should be in [ None, âDISPâ, âSPECRESâ].  The default is
None, which means it will return, in order of
precedence, the data in âDISPâ, âSPECRESâ, or a None
value if neither are present.</li>
<li><strong>toarray</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optiional) â Return the spectral resolution as a 2D array: Nspec x
Nwave, even if the DRP file is a CUBE object, similar to
<a class="reference internal" href="#mangadap.drpfits.DRPFits.copy_to_array" title="mangadap.drpfits.DRPFits.copy_to_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">DRPFits.copy_to_array()</span></code></a>.  Default is to return an
object with the same shape as the flux array.</li>
<li><strong>fill</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) â Fill masked values by interpolation.  Default is to
leave masked pixels in returned array.</li>
<li><strong>pre</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) â Read the pre-pixelized version of the spectral
resolution, instead of the post-pixelized version.  This
prepends âPREâ to the extension name.</li>
<li><strong>median</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, optional) â Return a single vector with the median spectral
resolution instead of a per spectrum array.  When using
the <cite>SPECRES</cite> extension, this just returns the vector
provided by the DRP file; when using the <cite>DISP</cite>
extension, this performs a masked median across the
array and then interpolates any wavelengths that were
masked in all vectors.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Even if interpolated such that
there should be not masked values, the function returns a
masked array.  Array contains the spectral resolution
(<span class="math notranslate nohighlight">\(R = \lambda/\Delta\lambda\)</span>) pulled from the DRP
file.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="http://docs.scipy.org/doc/numpy-1.10.1/reference/maskedarray.baseclass.html#numpy.ma.MaskedArray">numpy.ma.MaskedArray</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.spectral_resolution_header">
<code class="descname">spectral_resolution_header</code><span class="sig-paren">(</span><em>ext=None</em>, <em>pre=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.spectral_resolution_header"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.spectral_resolution_header" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return a fits header for the spectral resolution array.  Copies
the basic header from the relevant extension in the DRP file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext</strong> (<em>str</em>) â (<strong>Optional</strong>) Specify the extension with the
spectral estimate to use.  Should be in [ None, âDISPâ,
âSPECRESâ].  The default is None, which means it will
return, in order of precedence, the header for âDISPâ,
âSPECRESâ, or an empty header if neither are present.</li>
<li><strong>pre</strong> (<em>bool</em>) â (<strong>Optional</strong>) Read the pre-pixelized version of
the spectral resolution, instead of the post-pixelized
version.  This prepends âPREâ to the extension name.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.world_mesh">
<code class="descname">world_mesh</code><span class="sig-paren">(</span><em>skyright=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.world_mesh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.world_mesh" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the world X and Y coordinate for the <code class="xref py py-attr docutils literal notranslate"><span class="pre">nx</span></code> by
<code class="xref py py-attr docutils literal notranslate"><span class="pre">ny</span></code> mesh of the reconstructed image.  The pixel
coordinates are first determined using <a class="reference internal" href="#mangadap.drpfits.DRPFits.pix_mesh" title="mangadap.drpfits.DRPFits.pix_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">pix_mesh()</span></code></a> and then
converted to the world coordinate system.</p>
<p>For âCUBEâ files, this is done using the WCS information in the
header of the âFLUXâ extension.  See <a class="reference internal" href="#mangadap.drpfits.DRPFits.wcs" title="mangadap.drpfits.DRPFits.wcs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">wcs</span></code></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to v1_5_1 of the DRP, this function required a
correction to the DRP header because of its use of
âdegreesâ, which does not adhere to the fits standard
causing the <a class="reference external" href="http://docs.astropy.org/en/v1.0.2/api/astropy.wcs.WCS.html">astropy.wcs.wcs.WCS</a> to fail when initialized.
This call is not longer made.</p>
</div>
<div class="admonition-todo admonition" id="index-7">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Make check of DRP version âVERSDRPâ to determine if header
fix is necessary.</li>
</ul>
</div>
<p>For an âRSSâ file, the returned mesh is based on the offset in
arcseconds as determined by the dimensions of the reconstructed
image.  The <em>skyright</em> option will force the mesh to have a
<em>decreasing</em> x coordinate as a function of increasing index.
I.e.; the front edge of the first pixel is set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelscale</span> <span class="k">if</span> <span class="n">skyright</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span>
</pre></div>
</div>
<p>and the offset per pixel is set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pixelscale</span> <span class="k">if</span> <span class="n">skyright</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelscale</span>
</pre></div>
</div>
<p>Recall that <code class="xref py py-attr docutils literal notranslate"><span class="pre">xs</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">ys</span></code> are defined at the
bottom-left edge of the first image pixel.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>skyright</strong> (<em>bool</em>) â If True, return the mesh with x coordinates
<em>decreasing</em> as a function of increase index.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Two arrays with the world x and y
coordinates.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">numpy.ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.drpfits.DRPFits.world_mesh_range">
<code class="descname">world_mesh_range</code><span class="sig-paren">(</span><em>skyright=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFits.world_mesh_range"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFits.world_mesh_range" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the range in the world X and Y coordinates including the
size of the pixel.</p>
<p>For âRSSâ files, converts the result of <a class="reference internal" href="#mangadap.drpfits.DRPFits.pix_mesh_range" title="mangadap.drpfits.DRPFits.pix_mesh_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">pix_mesh_range()</span></code></a>
to world coordinates using the same calculation as in
<a class="reference internal" href="#mangadap.drpfits.DRPFits.world_mesh" title="mangadap.drpfits.DRPFits.world_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">world_mesh()</span></code></a>.</p>
<p>For âCUBEâ files, converts the result of <a class="reference internal" href="#mangadap.drpfits.DRPFits.pix_mesh" title="mangadap.drpfits.DRPFits.pix_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">pix_mesh()</span></code></a> with
<em>extent=True</em> to world coordinates using the same calculation as
in <a class="reference internal" href="#mangadap.drpfits.DRPFits.world_mesh" title="mangadap.drpfits.DRPFits.world_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">world_mesh()</span></code></a>.  The returned arrays give the range in X
and Y respectively.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">May not be accurate if the reconstructed image has an on-sky
rotation.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>skyright</strong> (<em>bool</em>) â Return the range in X such that the order
is [max(X), min(X)] if True; otherwise, values are
returned as [min(X), max(X)].</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Two arrays with, respectively, the range in X
and Y.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">numpy.ndarray</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to v1_5_1 of the DRP, this function required a
correction to the DRP header because of its use of
âdegreesâ, which does not adhere to the fits standard
causing the <a class="reference external" href="http://docs.astropy.org/en/v1.0.2/api/astropy.wcs.WCS.html">astropy.wcs.wcs.WCS</a> to fail when initialized.
This call is not longer made.</p>
</div>
<div class="admonition-todo admonition" id="index-8">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Make check of DRP version âVERSDRPâ to determine if header
fix is necessary.</li>
</ul>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="mangadap.drpfits.DRPFitsBitMask">
<em class="property">class </em><code class="descclassname">mangadap.drpfits.</code><code class="descname">DRPFitsBitMask</code><span class="sig-paren">(</span><em>sdss_maskbits=None</em>, <em>mode='CUBE'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPFitsBitMask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPFitsBitMask" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="mangadap.util.bitmask.html#mangadap.util.bitmask.BitMask" title="mangadap.util.bitmask.BitMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.bitmask.BitMask</span></code></a></p>
<p>Structure with the DRP mask bits.</p>
</dd></dl>

<dl class="class">
<dt id="mangadap.drpfits.DRPQuality3DBitMask">
<em class="property">class </em><code class="descclassname">mangadap.drpfits.</code><code class="descname">DRPQuality3DBitMask</code><span class="sig-paren">(</span><em>sdss_maskbits=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#DRPQuality3DBitMask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.DRPQuality3DBitMask" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="mangadap.util.bitmask.html#mangadap.util.bitmask.BitMask" title="mangadap.util.bitmask.BitMask"><code class="xref py py-class docutils literal notranslate"><span class="pre">mangadap.util.bitmask.BitMask</span></code></a></p>
<p>Structure with the definition of the DRP3QUAL mask bits.</p>
</dd></dl>

<dl class="function">
<dt id="mangadap.drpfits.drpfits_list">
<code class="descclassname">mangadap.drpfits.</code><code class="descname">drpfits_list</code><span class="sig-paren">(</span><em>platelist</em>, <em>ifudesignlist</em>, <em>modelist</em>, <em>combinatorics=False</em>, <em>drpver=None</em>, <em>redux_path=None</em>, <em>directory_path=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/drpfits.html#drpfits_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.drpfits.drpfits_list" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Provided a list of plates, ifudesigns, and modes, return a list of
DRP files to be analyzed by the DAP.</p>
<p>If the number of elements in each list is the same, the matching is
assumed to be finished unless combinatorics is True.  If the number
of elements is not the same, or cominatorics is True, the matched
list is all the combinations of the provided elements.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>platelist</strong> (<em>str</em><em> or </em><em>list</em>) â List of plates to use.</li>
<li><strong>ifudesignlist</strong> (<em>str</em><em> or </em><em>list</em>) â List of IFU designs to use.</li>
<li><strong>modelist</strong> (<em>str</em><em> or </em><em>list</em>) â List of DRP output modes (âCUBEâ or âRSSâ)</li>
<li><strong>combinatorics</strong> (<em>bool</em>) â (<strong>Optional</strong>) Based on the input
<em>platelist</em> and <em>ifudesignlist</em>, create a list with all
possible combinations.</li>
<li><strong>drpver</strong> (<em>str</em>) â (<strong>Optional</strong>) The DRP version, which <strong>must</strong> be
a single string value used for all DRP files.</li>
<li><strong>redux_path</strong> (<em>str</em>) â (<strong>Optional</strong>) The path to the top level
directory containing the DRP output files; this is the same
as the <em>redux_path</em> in the <a class="reference internal" href="#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal notranslate"><span class="pre">DRPFits</span></code></a> class.</li>
<li><strong>directory_path</strong> (<em>str</em>) â (<strong>Optional</strong>) The exact path to the DRP
file.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_drp_directory_path" title="mangadap.config.defaults.default_drp_directory_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">mangadap.config.defaults.default_drp_directory_path()</span></code></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A list of DRP file objects</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">list</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><code class="xref py py-exc docutils literal notranslate"><span class="pre">Exception</span></code> â Raised if <em>drpver</em> or <em>redux_path</em> are not strings.</li>
<li><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> â Raised if the <em>platelist</em>, <em>ifudesignlist</em>, or
<em>modelist</em> are None.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="mangadap.dapfits.html" class="btn btn-neutral" title="mangadap.dapfits module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, SDSS-IV/MaNGA Pipeline Group.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>