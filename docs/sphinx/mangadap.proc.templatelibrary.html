

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mangadap.proc.templatelibrary module &mdash; mangadap 2.2.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="mangadap 2.2.2 documentation" href="index.html"/>
        <link rel="up" title="mangadap.proc package" href="mangadap.proc.html"/>
        <link rel="next" title="mangadap.proc.util module" href="mangadap.proc.util.html"/>
        <link rel="prev" title="mangadap.proc.stellarcontinuummodel module" href="mangadap.proc.stellarcontinuummodel.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mangadap
          

          
          </a>

          
            
            
              <div class="version">
                2.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mangadap.html">mangadap package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="mangadap.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mangadap.config.html">mangadap.config package</a></li>
<li class="toctree-l3"><a class="reference internal" href="mangadap.contrib.html">mangadap.contrib package</a></li>
<li class="toctree-l3"><a class="reference internal" href="mangadap.par.html">mangadap.par package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="mangadap.proc.html">mangadap.proc package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="mangadap.proc.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="mangadap.proc.html#module-mangadap.proc">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mangadap.survey.html">mangadap.survey package</a></li>
<li class="toctree-l3"><a class="reference internal" href="mangadap.test.html">mangadap.test package</a></li>
<li class="toctree-l3"><a class="reference internal" href="mangadap.util.html">mangadap.util package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mangadap.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="mangadap.html#module-mangadap">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mangadap</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="mangadap.html">mangadap package</a> &raquo;</li>
        
          <li><a href="mangadap.proc.html">mangadap.proc package</a> &raquo;</li>
        
      <li>mangadap.proc.templatelibrary module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/mangadap.proc.templatelibrary.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-mangadap.proc.templatelibrary">
<span id="mangadap-proc-templatelibrary-module"></span><h1>mangadap.proc.templatelibrary module<a class="headerlink" href="#module-mangadap.proc.templatelibrary" title="Permalink to this headline">¶</a></h1>
<p>Class that reads and prepares template libraries for use in fitting the
stellar-continuum of a spectrum.  See
<a class="reference internal" href="#mangadap.proc.templatelibrary.available_template_libraries" title="mangadap.proc.templatelibrary.available_template_libraries"><code class="xref py py-func docutils literal"><span class="pre">available_template_libraries()</span></code></a> for the list of default template
libraries.</p>
<p>The “raw” template libraries are expected to consist of 1D fits files.
The wavelength sampling can be either linear or logarithmic in
wavelength.  The reference frame of the template wavelengths must be
defined as either vacuum or air.  It is expected that the object spectra
to be fit are calibrated to vacuum wavelengths.  When preparing the
template spectra for analysis, this class will use
<a class="reference external" href="http://pydl.readthedocs.io/en/stable/api/pydl.goddard.astro.airtovac.html#pydl.goddard.astro.airtovac">pydl.goddard.astro.airtovac</a> to convert the template wavelengths to
vacuum.  Finally, one can specify that the template library is only
valid within a certain wavelength range and above a certian flux limit;
see <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a>.</p>
<p>Preparation of the template library for use in stellar-continuum fitting
consists of a number of steps as described in the documentation of
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.process_template_library" title="mangadap.proc.templatelibrary.TemplateLibrary.process_template_library"><code class="xref py py-func docutils literal"><span class="pre">TemplateLibrary.process_template_library()</span></code></a>.</p>
<p>A template library that has been prepared for analysis is automatically
written to disk for later recovery.</p>
<p>Two support classes are also provided.  One is a derived
<a class="reference internal" href="mangadap.par.parset.html#mangadap.par.parset.ParSet" title="mangadap.par.parset.ParSet"><code class="xref py py-class docutils literal"><span class="pre">mangadap.par.parset.ParSet</span></code></a> instance that provides the defining
parameters of a DAP template library.  The second is a derived
<a class="reference internal" href="mangadap.util.bitmask.html#mangadap.util.bitmask.BitMask" title="mangadap.util.bitmask.BitMask"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.bitmask.BitMask</span></code></a> instance that defines the
bitmasks for the template library spectra.</p>
<dl class="docutils">
<dt><em>License</em>:</dt>
<dd><dl class="first last docutils">
<dt>Copyright (c) 2015, SDSS-IV/MaNGA Pipeline Group</dt>
<dd>Licensed under BSD 3-clause license - see LICENSE.rst</dd>
</dl>
</dd>
<dt><em>Source location</em>:</dt>
<dd>$MANGADAP_DIR/python/mangadap/proc/templatelibrary.py</dd>
<dt><em>Imports and python version compliance</em>:</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">InterpolatedUnivariateSpline</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">astropy.constants</span>
<span class="kn">from</span> <span class="nn">pydl.goddard.astro</span> <span class="k">import</span> <span class="n">airtovac</span>

<span class="kn">from</span> <span class="nn">..util.bitmask</span> <span class="k">import</span> <span class="n">BitMask</span>
<span class="kn">from</span> <span class="nn">..par.parset</span> <span class="k">import</span> <span class="n">ParSet</span>
<span class="kn">from</span> <span class="nn">..config.defaults</span> <span class="k">import</span> <span class="n">default_dap_source</span><span class="p">,</span> <span class="n">default_dap_common_path</span>
<span class="kn">from</span> <span class="nn">..config.defaults</span> <span class="k">import</span> <span class="n">default_dap_file_name</span>
<span class="kn">from</span> <span class="nn">..util.log</span> <span class="k">import</span> <span class="n">log_output</span>
<span class="kn">from</span> <span class="nn">..util.fileio</span> <span class="k">import</span> <span class="n">readfits_1dspec</span><span class="p">,</span> <span class="n">read_template_spectrum</span><span class="p">,</span> <span class="n">writefits_1dspec</span>
<span class="kn">from</span> <span class="nn">..util.instrument</span> <span class="k">import</span> <span class="n">resample1d</span><span class="p">,</span> <span class="n">resample_vector_npix</span><span class="p">,</span> <span class="n">SpectralResolution</span>
<span class="kn">from</span> <span class="nn">..util.instrument</span> <span class="k">import</span> <span class="n">match_spectral_resolution</span><span class="p">,</span> <span class="n">spectral_coordinate_step</span>
<span class="kn">from</span> <span class="nn">..util.parser</span> <span class="k">import</span> <span class="n">DefaultConfig</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="k">import</span> <span class="n">select_proc_method</span><span class="p">,</span> <span class="n">HDUList_mask_wavelengths</span>
</pre></div>
</div>
</dd>
<dt><em>Class usage examples</em>:</dt>
<dd><p class="first">Assuming you have the default directory structure setup, you can do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">from</span> <span class="nn">mangadap.drpfits</span> <span class="k">import</span> <span class="n">DRPFits</span>
<span class="kn">from</span> <span class="nn">mangadap.proc.templatelibrary</span> <span class="k">import</span> <span class="n">TemplateLibrary</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span>

<span class="c1"># Define the DRP file</span>
<span class="n">drpf</span> <span class="o">=</span> <span class="n">DRPFits</span><span class="p">(</span><span class="mi">7495</span><span class="p">,</span> <span class="mi">12703</span><span class="p">,</span> <span class="s1">&#39;CUBE&#39;</span><span class="p">)</span>

<span class="c1"># Build the template library</span>
<span class="n">tpl_lib</span> <span class="o">=</span> <span class="n">TemplateLibrary</span><span class="p">(</span><span class="s1">&#39;M11MILES&#39;</span><span class="p">,</span> <span class="n">drpf</span><span class="o">=</span><span class="n">drpf</span><span class="p">,</span> <span class="n">directory_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="c1"># Writes: ./manga-7495-12703-LOGCUBE_M11-MILES.fits</span>

<span class="c1"># Plot one of the spectra</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tpl_lib</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;WAVE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">tpl_lib</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>As part of the instantiation of the <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a> object
in the above call, the template library is prepared for use in
fitting the specified DRP file.  If the required processing has
already been done, the instantiation of the <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a>
object simply reads the existing file.  If you do not have the
default directory structure setup, you’ll need to define the paths
to, e.g., the DRP file; see <code class="xref py py-class docutils literal"><span class="pre">mangadap.dapfile.dapfile</span></code>.</p>
<p>If you do not want to process the template (match the spectral
resolution and sampling to that of the DRP data), you can force the
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a> object to only provide the “raw” spectra:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">from</span> <span class="nn">mangadap.proc.templatelibrary</span> <span class="k">import</span> <span class="n">TemplateLibrary</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span>

<span class="c1"># Read the raw template library</span>
<span class="n">tpl_lib</span> <span class="o">=</span> <span class="n">TemplateLibrary</span><span class="p">(</span><span class="s1">&#39;M11MILES&#39;</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Nothing should be written to disk</span>

<span class="c1"># Plot one of the spectra</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tpl_lib</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;WAVE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">tpl_lib</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that in the previous example, the wavelength data was already
one-dimensional, whereas for the raw library, the wavelength vector
can be spectrum-dependent.</p>
<p>In the above examples, the user has not provided a list of template
libraries, meaning that the default set available to the DAP is
used.  The default set is defined in
<a class="reference internal" href="#mangadap.proc.templatelibrary.available_template_libraries" title="mangadap.proc.templatelibrary.available_template_libraries"><code class="xref py py-func docutils literal"><span class="pre">available_template_libraries()</span></code></a>.  If you want to use your own
template library, you have to define its parameters using
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a>.  Currently, the template library
spectra are expected to be 1D fits files with WCS header keywords
defining the wavelength solution; see above.  Using an existing DAP
library as an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">from</span> <span class="nn">mangadap.proc.templatelibrary</span> <span class="k">import</span> <span class="n">TemplateLibraryDef</span>
<span class="kn">from</span> <span class="nn">mangadap.proc.templatelibrary</span> <span class="k">import</span> <span class="n">TemplateLibrary</span>
<span class="kn">from</span> <span class="nn">mangadap.config.defaults</span> <span class="k">import</span> <span class="n">default_dap_source</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span>

<span class="c1"># Define the search string for the library</span>
<span class="n">search_str</span> <span class="o">=</span> <span class="n">default_dap_source</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/data/stellar_templates/miles/*.fits&#39;</span>

<span class="c1"># Define the template library parameters</span>
<span class="n">tpl_par</span> <span class="o">=</span> <span class="n">TemplateLibraryDef</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;MILES&#39;</span><span class="p">,</span>    <span class="c1"># Unique keyword for the library</span>
                        <span class="n">file_search</span><span class="o">=</span><span class="n">search_str</span><span class="p">,</span> <span class="c1"># Search string</span>
                        <span class="n">fwhm</span><span class="o">=</span><span class="mf">2.50</span><span class="p">,</span>              <span class="c1"># FWHM of resolution element (assumed const)</span>
                        <span class="n">in_vacuum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>        <span class="c1"># Wavelength in vacuum?</span>
                        <span class="n">wave_limit</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">3575.</span><span class="p">,</span> <span class="mf">7400.</span> <span class="p">]),</span>   <span class="c1"># Range of valid lambda</span>
                        <span class="n">lower_flux_limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>   <span class="c1"># Lower limit for valid flux</span>

<span class="c1"># Read the raw template library</span>
<span class="n">tpl_lib</span> <span class="o">=</span> <span class="n">TemplateLibrary</span><span class="p">(</span><span class="s1">&#39;MILES&#39;</span><span class="p">,</span> <span class="n">tpllib_list</span><span class="o">=</span><span class="n">tpl_par</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Nothing should be written to disk</span>

<span class="c1"># Plot one of the spectra</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tpl_lib</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;WAVE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">tpl_lib</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="s1">&#39;FLUX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the keyword you use must be provided both to the parameter
set and when instantiating the <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a> object.  In
the example above, I have not processed the library, but you can by
following a similar approach to the first example.</p>
<p class="last">You can also process the spectra to a user-provided resolution and
pixel sampling, toggle on/off the renormalization of the library to
a mean flux of unity and define various paths if you’re not working
within the nominal DAP directory structure.  See the optional
instantiation arguments for <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a>.</p>
</dd>
<dt><em>Revision history</em>:</dt>
<dd><div class="first last line-block">
<div class="line"><strong>23 Apr 2015</strong>: Implementation begun by K. Westfall (KBW)</div>
<div class="line"><strong>26 May 2015</strong>: (KBW) Added some Sphinx documentation.</div>
<div class="line"><strong>17 Jun 2015</strong>: (KBW) Added flexibility in definition of template
libraries from which to choose using the new
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a> class.</div>
<div class="line"><strong>23 Jun 2015</strong>: (KBW) Allow user to provided non-DRP input
spectra, meaning they need to provide the velocity scale and the
wavelength and spectral resolution vectors.  They must also
directly set the name of the output processed file.</div>
<div class="line"><strong>01 Feb 2016</strong>: (KBW) Propagated changes to
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a> and changed procedure for reading
raw template library.</div>
<div class="line"><strong>04 Feb 2016</strong>: (KBW) Converted from
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.log_rebin()</span></code> to
<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.resample_vector" title="mangadap.util.instrument.resample_vector"><code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.resample_vector()</span></code></a>.  Allows input
library to be logarithmically sampled and provides a different
approach to subsampling spectra.  Implemented other convenience
operations, such as selecting a certain wavelength range for the
processed library.</div>
<div class="line"><strong>19 May 2016</strong>: (KBW) Added loggers and quiet keyword arguments
to <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a></div>
<div class="line"><strong>22 Jun 2016</strong>: (KBW) Included MILESHC library in documentation.
Allow to specify how the resolution and sampling are matched to
the DRP data.  The <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="mangadap.proc.templatelibrary.TemplateLibrary"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibrary</span></code></a> class should be
generalized to make this more transparent (and unnecessary).</div>
<div class="line"><strong>03 Apr 2017</strong>: (KBW) Include arguments for
<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.match_spectral_resolution" title="mangadap.util.instrument.match_spectral_resolution"><code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.match_spectral_resolution()</span></code></a> that
specify the minimum sigma in pixels for the convolution kernel
and any offset in the resolution required in the call for the
template library.  Check that the resampling of the spectrum
does not reach the two-pixel resolution limit; flag the spectrum
in those regions that do and change the resolution to the two
pixel limit.</div>
<div class="line"><strong>30 Aug 2017</strong>: (KBW) Switch from using
<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.resample_vector" title="mangadap.util.instrument.resample_vector"><code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.resample_vector()</span></code></a> to
<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.resample1d" title="mangadap.util.instrument.resample1d"><code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.resample1d()</span></code></a></div>
</div>
</dd>
</dl>
<dl class="class">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary">
<em class="property">class </em><code class="descclassname">mangadap.proc.templatelibrary.</code><code class="descname">TemplateLibrary</code><span class="sig-paren">(</span><em>library_key</em>, <em>tpllib_list=None</em>, <em>dapsrc=None</em>, <em>drpf=None</em>, <em>match_to_drp_resolution=True</em>, <em>velscale_ratio=None</em>, <em>sres=None</em>, <em>velocity_offset=0.0</em>, <em>min_sig_pix=0.0</em>, <em>no_offset=True</em>, <em>spectral_step=None</em>, <em>log=True</em>, <em>wavelength_range=None</em>, <em>renormalize=True</em>, <em>dapver=None</em>, <em>analysis_path=None</em>, <em>directory_path=None</em>, <em>processed_file=None</em>, <em>read=True</em>, <em>process=True</em>, <em>hardcopy=True</em>, <em>symlink_dir=None</em>, <em>clobber=False</em>, <em>checksum=False</em>, <em>loggers=None</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Object used to read, store, and prepare template libraries for use
in analyzing object spectra.</p>
<p>The default list of available libraries provided by the MaNGA DAP
defined in <a class="reference internal" href="#mangadap.proc.templatelibrary.available_template_libraries" title="mangadap.proc.templatelibrary.available_template_libraries"><code class="xref py py-func docutils literal"><span class="pre">available_template_libraries()</span></code></a>.  The user can
provide their own library for use with this class provided they are
contained in 1D fits spectra, sampled linearly in wavelength with
the wavelength coordinates available via the WCS keywords (CRPIX1,
CRVAL1, CDELT1), and they have an appropriately defined spectral
resolution (FWHM in angstroms that is constant as a function of
wavelength).  See <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a> and
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary._build_raw_hdu" title="mangadap.proc.templatelibrary.TemplateLibrary._build_raw_hdu"><code class="xref py py-func docutils literal"><span class="pre">_build_raw_hdu()</span></code></a>.</p>
<p>The class is optimized for use in analyzing MaNGA DRP files;
however, one can provide the necessary information so that the class
can be used with a non-DRP spectrum.  In the latter case, the user
must supply the velocity scale of the pixel for the logarithmically
resampled template library, and a
<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.SpectralResolution" title="mangadap.util.instrument.SpectralResolution"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.instrument.SpectralResolution</span></code></a> object the
defines the instrumental resolution of the spectrum/spectra to be
analyzed.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>below is out of date.</li>
<li>Only works with DRP files that have log-linear wavelength
binning!</li>
<li>Allow to process, where process is just to change the
sampling or the resolution (not necessarily both).</li>
<li>Need to make this more general, removing all dependence on
DRPFits object.  This would simplify the functionality to
change how the resolution and sampling matching is specified.</li>
</ul>
</div>
<p>On initialization, if the DRP file object is not provided (is None),
the default behavior is to read the raw template library if
read=True.  If the DRP file is provided, the routine will check for
the resolution matched fits file; if it doesn’t exist and read is
True, it will prepare the template library for use in analyzing the
DRP file and write the prepared library file.  If clobber=True, the
preparation and writing of the template library will be done even if
the library already exists.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>library_key</strong> (<em>str</em>) – Keyword selecting the library to use.</li>
<li><strong>tpllib_list</strong> (<em>list</em>) – (<strong>Optional</strong>) List of
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a> objects that define the
parameters required to read and interpret a template
library.  The <em>library_key</em> must select one of the objects
in this list.</li>
<li><strong>dapsrc</strong> (<em>str</em>) – (<strong>Optional</strong>) Root path to the DAP source
directory.  If not provided, the default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_source" title="mangadap.config.defaults.default_dap_source"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_source()</span></code></a>.</li>
<li><strong>drpf</strong> (<a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a>) – (<strong>Optional</strong>) DRP
file (object) with which the template library is associated
for analysis</li>
<li><strong>match_to_drp_resolution</strong> (<em>bool</em>) – (<strong>Optional</strong>) Match the
spectral resolution of the template library to the
resolution provided by the <a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a>
object; the latter must be provided for this argument to
have any use.</li>
<li><strong>velscale_ratio</strong> (<em>int</em>) – (<strong>Optional</strong>) Resample the template
spectra such that the ratio of the pixel scale in the
provided <a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a> object is this
many times larger than the pixels in the resampled template
spectrum.</li>
<li><strong>sres</strong> (<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.SpectralResolution" title="mangadap.util.instrument.SpectralResolution"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.instrument.SpectralResolution</span></code></a>) – (<strong>Optional</strong>) The object is used simply to access the
spectral resolution and associated wavelength coordinate
vector needed when matching the spectral resolution of the
template library; this is used in place of the attributes in
any provided DRP file object.</li>
<li><strong>velocity_offset</strong> (<em>float</em>) – (<strong>Optional</strong>) Velocity offset to use
when matching the spectral resolution between the template
library and the galaxy spectra.</li>
<li><strong>spectral_step</strong> (<em>float</em>) – (<strong>Optional</strong>) Target logarithmic
(<a href="#id1"><span class="problematic" id="id2">*</span></a>log*=True) or linear (<a href="#id3"><span class="problematic" id="id4">*</span></a>log*=False) step in wavelength for
the template library.</li>
<li><strong>log</strong> (<em>bool</em>) – (<strong>Optional</strong>) Flag to force the library to be
logarithmically sampled in wavelength.</li>
<li><strong>wavelength_range</strong> (<em>array-like</em>) – (<strong>Optional</strong>) Force
the template library to covert this spectral range.
Unobserved spectral regions will be flagged.</li>
<li><strong>renormalize</strong> (<em>bool</em>) – (<strong>Optional</strong>) After processing,
renormalize the flux to unity.</li>
<li><strong>dapver</strong> (<em>str</em>) – (<strong>Optional</strong>) DAP version, which is used to
define the default DAP analysis path.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_version" title="mangadap.config.defaults.default_dap_version"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_version()</span></code></a></li>
<li><strong>analysis_path</strong> (<em>str</em>) – (<strong>Optional</strong>) The path to the top level
directory containing the DAP output files for a given DRP
and DAP version.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_analysis_path" title="mangadap.config.defaults.default_analysis_path"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_analysis_path()</span></code></a>.</li>
<li><strong>directory_path</strong> (<em>str</em>) – (<strong>Optional</strong>) The exact path to the
processed template library file.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_common_path" title="mangadap.config.defaults.default_dap_common_path"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_common_path()</span></code></a>.</li>
<li><strong>processed_file</strong> (<em>str</em>) – (<strong>Optional</strong>) The name of the file
containing the prepared template library output file.  The
file should be found at
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.directory_path" title="mangadap.proc.templatelibrary.TemplateLibrary.directory_path"><code class="xref py py-attr docutils literal"><span class="pre">directory_path</span></code></a>/<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed_file" title="mangadap.proc.templatelibrary.TemplateLibrary.processed_file"><code class="xref py py-attr docutils literal"><span class="pre">processed_file</span></code></a>.  Default is
defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_file_name" title="mangadap.config.defaults.default_dap_file_name"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_file_name()</span></code></a>.</li>
<li><strong>process</strong> (<em>bool</em>) – (<strong>Optional</strong>) If <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.drpf" title="mangadap.proc.templatelibrary.TemplateLibrary.drpf"><code class="xref py py-attr docutils literal"><span class="pre">drpf</span></code></a> is defined and
the prepared template library does not exist, this will
process the template library in preparation for use in
fitting the provided DRP file.</li>
<li><strong>hardcopy</strong> (<em>bool</em>) – (<strong>Optional</strong>) Flag to keep a hardcopy of the
processed template library.  Default is True.</li>
<li><strong>symlink_dir</strong> (<em>str</em>) – (<strong>Optional</strong>) Create a symlink to the file
in this directory.  Default is for no symlink.</li>
<li><strong>clobber</strong> (<em>bool</em>) – (<strong>Optional</strong>) If <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.drpf" title="mangadap.proc.templatelibrary.TemplateLibrary.drpf"><code class="xref py py-attr docutils literal"><span class="pre">drpf</span></code></a> is define and
<em>process</em> is True, this will clobber any existing processed
template library.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.bitmask">
<code class="descname">bitmask</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.bitmask" title="Permalink to this definition">¶</a></dt>
<dd><p><em>BitMask</em> – A BitMask object used to toggle mask values;
see <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryBitMask" title="mangadap.proc.templatelibrary.TemplateLibraryBitMask"><code class="xref py py-func docutils literal"><span class="pre">TemplateLibraryBitMask()</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.library">
<code class="descname">library</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.library" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a> – Parameter set required to
read and prepare the library.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.file_list">
<code class="descname">file_list</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.file_list" title="Permalink to this definition">¶</a></dt>
<dd><p><em>list</em> – The list of files found using <a class="reference external" href="https://docs.python.org/3.4/library/glob.html">glob.glob</a> and
<code class="xref py py-attr docutils literal"><span class="pre">file_search</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.ntpl">
<code class="descname">ntpl</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.ntpl" title="Permalink to this definition">¶</a></dt>
<dd><p><em>int</em> – Number of template spectra in the library</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.drpf">
<code class="descname">drpf</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.drpf" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a> – DRP file (object) with
which the template library is associated for analysis</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.sres">
<code class="descname">sres</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.sres" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.SpectralResolution" title="mangadap.util.instrument.SpectralResolution"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.instrument.SpectralResolution</span></code></a> – The object is used simply to access the spectral resolution
and associated wavelength coordinate vector needed when
matching the spectral resolution of the template library;
this is used in place of the attributes in any provided DRP
file object.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.velocity_offset">
<code class="descname">velocity_offset</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.velocity_offset" title="Permalink to this definition">¶</a></dt>
<dd><p><em>float</em> – Velocity offset to use when matching
the spectral resolution between the template library and the
galaxy spectra.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.spectral_step">
<code class="descname">spectral_step</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.spectral_step" title="Permalink to this definition">¶</a></dt>
<dd><p><em>float</em> – Target logarithmic
(:attr:<a href="#id5"><span class="problematic" id="id6">`</span></a>log10_sampling`=True) or linear
(:attr:<a href="#id7"><span class="problematic" id="id8">`</span></a>log10_sampling`=False) step in wavelength for the
template library.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.log10_sampling">
<code class="descname">log10_sampling</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.log10_sampling" title="Permalink to this definition">¶</a></dt>
<dd><p><em>bool</em> – Flag that the processed template library is
logarithmically sampled in wavelength.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.directory_path">
<code class="descname">directory_path</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.directory_path" title="Permalink to this definition">¶</a></dt>
<dd><p><em>str</em> – The exact path to the processed template
library file.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_common_path" title="mangadap.config.defaults.default_dap_common_path"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_common_path()</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.processed_file">
<code class="descname">processed_file</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed_file" title="Permalink to this definition">¶</a></dt>
<dd><p><em>str</em> – The name of the file containing (to
contain) the prepared template library output file.  The
file should be found at
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.directory_path" title="mangadap.proc.templatelibrary.TemplateLibrary.directory_path"><code class="xref py py-attr docutils literal"><span class="pre">directory_path</span></code></a>/<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed_file" title="mangadap.proc.templatelibrary.TemplateLibrary.processed_file"><code class="xref py py-attr docutils literal"><span class="pre">processed_file</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.processed">
<code class="descname">processed</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed" title="Permalink to this definition">¶</a></dt>
<dd><p><em>bool</em> – Flag that the template library has been
prepared for use in the DAP.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.hardcopy">
<code class="descname">hardcopy</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.hardcopy" title="Permalink to this definition">¶</a></dt>
<dd><p><em>bool</em> – Flag to keep a hardcopy of the processed
template library.</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.symlink_dir">
<code class="descname">symlink_dir</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.symlink_dir" title="Permalink to this definition">¶</a></dt>
<dd><p><em>str</em> – Symlink created to the file in this directory</p>
</dd></dl>

<dl class="attribute">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.hdu">
<code class="descname">hdu</code><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.hdu" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="http://docs.astropy.org/en/v1.0.2/io/fits/api/hdulists.html">astropy.io.fits.hdu.hdulist.HDUList</a> – HDUList read from
the DAP file</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._build_raw_hdu">
<code class="descname">_build_raw_hdu</code><span class="sig-paren">(</span><em>npix</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._build_raw_hdu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._build_raw_hdu" title="Permalink to this definition">¶</a></dt>
<dd><p>Build the “raw” template library arrays.  This simply reads the
provided list of fits files and puts them into arrays of size
<span class="math">\(N_{\rm tpl} \times N_{\rm pix}\)</span>.</p>
<p>This will <em>force</em> reading of the data, even if the <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.hdu" title="mangadap.proc.templatelibrary.TemplateLibrary.hdu"><code class="xref py py-attr docutils literal"><span class="pre">hdu</span></code></a>
is already initialized.</p>
<p>The <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.hdu" title="mangadap.proc.templatelibrary.TemplateLibrary.hdu"><code class="xref py py-attr docutils literal"><span class="pre">hdu</span></code></a> will contain the appropriate extensions, but it
is important to note that the wavelength vectors will <strong>not</strong>
necessarily be the same.  That is, reading of the raw template
spectra can accommodate spectra that have different wavelength
coordinates.  Any pixels that have no data are masked using the
‘NO_DATA’ bitmask flag; see
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryBitMask" title="mangadap.proc.templatelibrary.TemplateLibraryBitMask"><code class="xref py py-func docutils literal"><span class="pre">TemplateLibraryBitMask()</span></code></a>.</p>
<p>The spectral resolution is set using <code class="xref py py-attr docutils literal"><span class="pre">fwhm</span></code>, and the
spectral resolution offset is initialized to zero (see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.GaussianKernelDifference()</span></code>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Currently no errors are saved because none are expected for
the template libraries.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>npix</strong> (<em>int</em>) – Number of spectral channels for the output
arrays</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._can_set_paths">
<code class="descname">_can_set_paths</code><span class="sig-paren">(</span><em>directory_path</em>, <em>drpf</em>, <em>processed_file</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._can_set_paths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._can_set_paths" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._define_library">
<code class="descname">_define_library</code><span class="sig-paren">(</span><em>library_key</em>, <em>tpllib_list=None</em>, <em>dapsrc=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._define_library"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._define_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Select the library from the provided list.  Used to set
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.library" title="mangadap.proc.templatelibrary.TemplateLibrary.library"><code class="xref py py-attr docutils literal"><span class="pre">library</span></code></a>; see
<a class="reference internal" href="mangadap.proc.util.html#mangadap.proc.util.select_proc_method" title="mangadap.proc.util.select_proc_method"><code class="xref py py-func docutils literal"><span class="pre">mangadap.proc.util.select_proc_method()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>library_key</strong> (<em>str</em>) – Keyword of the selected library.
Available libraries are proved by
<code class="xref py py-func docutils literal"><span class="pre">available__template_libraries()</span></code></li>
<li><strong>tpllib_list</strong> (<em>list</em>) – (<strong>Optional</strong>) List of
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a>
objects that define the parameters required to read and
interpret a template library.</li>
<li><strong>dapsrc</strong> (<em>str</em>) – (<strong>Optional</strong>) Root path to the DAP source
directory.  If not provided, the default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_source" title="mangadap.config.defaults.default_dap_source"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_source()</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._get_file_list">
<code class="descname">_get_file_list</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._get_file_list"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._get_file_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._get_nchannels">
<code class="descname">_get_nchannels</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._get_nchannels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._get_nchannels" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the maximum number of wavelength channels needed to store
all the template spectra in a single array.</p>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>What happens if the spectrum has an empty primary
extension?</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Maximum number of pixels used by the listed spectra.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">int</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code> – Raised if the input template spectra are not
one-dimensional.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._minimum_sampling">
<code class="descname">_minimum_sampling</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._minimum_sampling"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._minimum_sampling" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the minimum sampling of the available wavelength vectors.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">minimum sampling of all (will just be one if the
library has been processed) wavelength vectors.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._modify_spectral_resolution">
<code class="descname">_modify_spectral_resolution</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._modify_spectral_resolution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._modify_spectral_resolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify the spectral resolution to match the provided
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.sres" title="mangadap.proc.templatelibrary.TemplateLibrary.sres"><code class="xref py py-attr docutils literal"><span class="pre">sres</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Redshift used when matching the spectral resolution.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._process_library">
<code class="descname">_process_library</code><span class="sig-paren">(</span><em>wavelength_range=None</em>, <em>renormalize=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._process_library"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._process_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the template library for use in analyzing object
spectra.   See <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.process_template_library" title="mangadap.proc.templatelibrary.TemplateLibrary.process_template_library"><code class="xref py py-func docutils literal"><span class="pre">process_template_library()</span></code></a>.</p>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Add wavelength coordinate WCS information to the
appropriate extension headers.</li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._read_raw">
<code class="descname">_read_raw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._read_raw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._read_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the ‘raw’ versions of the template library; i.e., the
library before it has been resolution and sampling matched to a
DRP file.</p>
<p>The file list read by the search key is sorted for consistency.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._rebin_masked">
<code class="descname">_rebin_masked</code><span class="sig-paren">(</span><em>i</em>, <em>flag</em>, <em>fullRange</em>, <em>rmsk_lim=0.5</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._rebin_masked"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._rebin_masked" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the mask value to adopt for a rebinned spectrum by
rebinning the mask pixels, setting a masked pixel to unity, and
an unmasked pixel to zero.  After rebinning, any pixel with a
value of larger than <em>rmsk_lim</em> is masked; otherwise it is left
unmasked.</p>
<p>Although the function can be used with multiple flags, its
intended use is to determine which pixels should be masked with
a specific flag.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>i</strong> (<em>int</em>) – Index of the spectrum to be rebinned.</li>
<li><strong>flag</strong> (<em>str</em><em> or </em><em>list</em>) – Flags to consider when determining which
pixels to mask; see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.bitmasks.BitMask.flagged()</span></code>.</li>
<li><strong>fullRange</strong> (<em>numpy.ndarray</em>) – Two-element array with the
wavelength range for the rebinned spectrum.</li>
<li><strong>rmsk_lim</strong> (<em>float</em>) – Limit of the rebinned mask value that is
allowed before considering the pixel as masked.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The indices of the pixels in the rebinned spectrum
that should be masked.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._reset_hdu">
<code class="descname">_reset_hdu</code><span class="sig-paren">(</span><em>wave</em>, <em>flux</em>, <em>mask</em>, <em>sres</em>, <em>soff</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._reset_hdu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._reset_hdu" title="Permalink to this definition">¶</a></dt>
<dd><p>(Re)Set <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.hdu" title="mangadap.proc.templatelibrary.TemplateLibrary.hdu"><code class="xref py py-attr docutils literal"><span class="pre">hdu</span></code></a> to a new HDUList object using the input
arrays.  Also sets the header items indicating the version of
the template reader and the keyword for the library.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>wave</strong> (<em>numpy.ndarray</em>) – Array with the wavelengths of each
pixel.</li>
<li><strong>flux</strong> (<em>numpy.ndarray</em>) – Array with the flux in each pixel.</li>
<li><strong>mask</strong> (<em>numpy.ndarray</em>) – Bitmask values for each pixel.</li>
<li><strong>sres</strong> (<em>numpy.ndarray</em>) – Spectral resolution,
<span class="math">\(R=\lambda/\delta\lambda\)</span>, at each pixel.</li>
<li><strong>soff</strong> (<em>numpy.ndarray</em>) – The spectral resolution offset for
each spectrum (see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.GaussianKernelDifference()</span></code>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._set_paths">
<code class="descname">_set_paths</code><span class="sig-paren">(</span><em>directory_path</em>, <em>dapver</em>, <em>analysis_path</em>, <em>drpf</em>, <em>processed_file</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._set_paths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._set_paths" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the I/O path to the processed template library.  Used to set
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.directory_path" title="mangadap.proc.templatelibrary.TemplateLibrary.directory_path"><code class="xref py py-attr docutils literal"><span class="pre">directory_path</span></code></a> and <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed_file" title="mangadap.proc.templatelibrary.TemplateLibrary.processed_file"><code class="xref py py-attr docutils literal"><span class="pre">processed_file</span></code></a>.  If not
provided, the defaults are set using, respectively,
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_common_path" title="mangadap.config.defaults.default_dap_common_path"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_common_path()</span></code></a> and
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_file_name" title="mangadap.config.defaults.default_dap_file_name"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_file_name()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>directory_path</strong> (<em>str</em>) – The exact path to the DAP template
library file.  See <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.directory_path" title="mangadap.proc.templatelibrary.TemplateLibrary.directory_path"><code class="xref py py-attr docutils literal"><span class="pre">directory_path</span></code></a>.</li>
<li><strong>dapver</strong> (<em>str</em>) – DAP version.</li>
<li><strong>analysis_path</strong> (<em>str</em>) – The path to the top-level directory
containing the DAP output files for a given DRP and DAP
version.</li>
<li><strong>drpf</strong> (<a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a>) – The container
object of the DRP file that is used to construct the
path for the processed template library.</li>
<li><strong>processed_file</strong> (<em>str</em>) – The name of the file with the prepared
template library.  See <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed_file" title="mangadap.proc.templatelibrary.TemplateLibrary.processed_file"><code class="xref py py-attr docutils literal"><span class="pre">processed_file</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary._wavelength_range">
<code class="descname">_wavelength_range</code><span class="sig-paren">(</span><em>flag=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary._wavelength_range"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary._wavelength_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the valid wavelength range for each spectrum based on the
first and last unmasked pixel; interspersed masked regions are
not considered.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>flag</strong> (<em>str</em><em> or </em><em>list</em>) – (<strong>Optional</strong>) Flags to consider when
determining the wavelength range; see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.bitmasks.BitMask.flagged()</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Two-element vector with wavelengths of the
first and last valid pixels.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">numpy.ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.file_name">
<code class="descname">file_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary.file_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.file_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the name of the processed file.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.file_path">
<code class="descname">file_path</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary.file_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.file_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the full path to the processed file.</p>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.process_template_library">
<code class="descname">process_template_library</code><span class="sig-paren">(</span><em>library_key=None</em>, <em>tpllib_list=None</em>, <em>dapsrc=None</em>, <em>drpf=None</em>, <em>match_to_drp_resolution=True</em>, <em>velscale_ratio=None</em>, <em>sres=None</em>, <em>velocity_offset=0.0</em>, <em>min_sig_pix=0.0</em>, <em>no_offset=True</em>, <em>spectral_step=None</em>, <em>log=True</em>, <em>wavelength_range=None</em>, <em>renormalize=True</em>, <em>dapver=None</em>, <em>analysis_path=None</em>, <em>directory_path=None</em>, <em>processed_file=None</em>, <em>hardcopy=True</em>, <em>symlink_dir=None</em>, <em>clobber=False</em>, <em>loggers=None</em>, <em>quiet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary.process_template_library"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.process_template_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the template library for use in analyzing object
spectra.  Primary steps are to:</p>
<blockquote>
<div><ul class="simple">
<li>Read the raw 1D fits files; see <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary._read_raw" title="mangadap.proc.templatelibrary.TemplateLibrary._read_raw"><code class="xref py py-func docutils literal"><span class="pre">_read_raw()</span></code></a>.</li>
<li>Convert the wavelengths to vacuum, if necessary; see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.idlutils.airtovac()</span></code>.</li>
<li>Mask wavelengths outside the rest wavelength range of the
DRP spectrum, due to need to extrapolate these values; see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.bitmasks.HDUList_mask_wavelengths()</span></code>.</li>
<li>Match the spectral resolution of the template to that of
the DRP spectra; see
<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.match_spectral_resolution" title="mangadap.util.instrument.match_spectral_resolution"><code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.match_spectral_resolution()</span></code></a>.</li>
<li>Mask the template pixels where the spectral resolution was
too low to match to the DRP spectra; see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.bitmasks.BitMask.turn_on()</span></code>.</li>
<li>Force a common wavelength range and sampling for all
templates, where the sampling is forced to match the
sampling of the DRP spectra; see
<code class="xref py py-func docutils literal"><span class="pre">mangadap.util.instrument.resample_vector_pix()</span></code>.  The masks
are appropriately resampled as well; see
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary._rebin_masked" title="mangadap.proc.templatelibrary.TemplateLibrary._rebin_masked"><code class="xref py py-func docutils literal"><span class="pre">_rebin_masked()</span></code></a>.</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The routine <strong>does not</strong> check that that an existing
processed file or the existing object has been processed
using the same DRPFits, velocity_offset, velscale, or sres
input.  If unsure, use clobber=True.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>library_key</strong> (<em>str</em>) – (<strong>Optional</strong>) Keyword selecting the library
to use; default is to use existing <a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.library" title="mangadap.proc.templatelibrary.TemplateLibrary.library"><code class="xref py py-attr docutils literal"><span class="pre">library</span></code></a>.</li>
<li><strong>tpllib_list</strong> (<em>list</em>) – (<strong>Optional</strong>) List of
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a>
objects that define the parameters required to read and
interpret a template library.  Input ignored if
<em>library_key</em> is None.</li>
<li><strong>dapsrc</strong> (<em>str</em>) – (<strong>Optional</strong>) Root path to the DAP source
directory.  If not provided, the default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_source" title="mangadap.config.defaults.default_dap_source"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_source()</span></code></a>.
Input ignored if <em>library_key</em> is None.</li>
<li><strong>drpf</strong> (<a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a>) – (<strong>Optional</strong>) DRP
file (object) with which the template library is
associated for analysis.  <strong>If not provided</strong>, the user
must define <em>velscale</em> and <em>sres</em> such that the library
can be processed; and the user must provide
<em>directory_path</em> and <em>processed_file</em> such that the
output file can be written.</li>
<li><strong>match_to_drp_resolution</strong> (<em>bool</em>) – (<strong>Optional</strong>) Match the
spectral resolution of the template library to the
resolution provided by the
<a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a> object; the latter
must be provided for this argument to have any use.</li>
<li><strong>velscale_ratio</strong> (<em>int</em>) – (<strong>Optional</strong>) Resample the template
spectra such that the ratio of the pixel scale in the
provided <a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a> object is
this many times larger than the pixels in the resampled
template spectrum.</li>
<li><strong>sres</strong> (<a class="reference internal" href="mangadap.util.instrument.html#mangadap.util.instrument.SpectralResolution" title="mangadap.util.instrument.SpectralResolution"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.instrument.SpectralResolution</span></code></a>) – (<strong>Optional</strong>) The object is used simply to access the
spectral resolution and associated wavelength coordinate
vector needed when matching the spectral resolution of
the template library.  This takes prededence over the
values provided by the DRP file object.</li>
<li><strong>velocity_offset</strong> (<em>float</em>) – (<strong>Optional</strong>) Velocity offset to use
when matching the spectral resolution between the
template library and the galaxy spectra.</li>
<li><strong>spectral_step</strong> (<em>float</em>) – (<strong>Optional</strong>) Target logarithmic
(<a href="#id9"><span class="problematic" id="id10">*</span></a>log*=True) or linear (<a href="#id11"><span class="problematic" id="id12">*</span></a>log*=False) step in wavelength for
the template library.</li>
<li><strong>log</strong> (<em>bool</em>) – (<strong>Optional</strong>) Flag to force the library to be
logarithmically sampled in wavelength.</li>
<li><strong>wavelength_range</strong> (<em>array-like</em>) – (<strong>Optional</strong>) Force the
template library to covert this spectral range.  Unobserved
spectral regions will be flagged.</li>
<li><strong>renormalize</strong> (<em>bool</em>) – (<strong>Optional</strong>) After processing, renormalize
the flux to unity.</li>
<li><strong>dapver</strong> (<em>str</em>) – (<strong>Optional</strong>) DAP version, which is used to
define the default DAP analysis path.  Default is
defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_version" title="mangadap.config.defaults.default_dap_version"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_version()</span></code></a></li>
<li><strong>analysis_path</strong> (<em>str</em>) – (<strong>Optional</strong>) The path to the top level
directory containing the DAP output files for a given
DRP and DAP version.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_analysis_path" title="mangadap.config.defaults.default_analysis_path"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_analysis_path()</span></code></a>.</li>
<li><strong>directory_path</strong> (<em>str</em>) – (<strong>Optional</strong>) The exact path for the
processed template library file.  Default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_common_path" title="mangadap.config.defaults.default_dap_common_path"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_common_path()</span></code></a>.</li>
<li><strong>processed_file</strong> (<em>str</em>) – (<strong>Optional</strong>) The name of the file
containing (to contain) the prepared template library
output file.  The file should be found at
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.directory_path" title="mangadap.proc.templatelibrary.TemplateLibrary.directory_path"><code class="xref py py-attr docutils literal"><span class="pre">directory_path</span></code></a>/<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibrary.processed_file" title="mangadap.proc.templatelibrary.TemplateLibrary.processed_file"><code class="xref py py-attr docutils literal"><span class="pre">processed_file</span></code></a>.  Default
is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_file_name" title="mangadap.config.defaults.default_dap_file_name"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_file_name()</span></code></a>.</li>
<li><strong>hardcopy</strong> (<em>bool</em>) – (<strong>Optional</strong>) Flag to keep a hardcopy of
the processed template library.  Default is True.</li>
<li><strong>symlink_dir</strong> (<em>str</em>) – (<strong>Optional</strong>) Create a symlink to the
file in this directory.  Default is for no symlink.</li>
<li><strong>clobber</strong> (<em>bool</em>) – (<strong>Optional</strong>) Clobber any existing processed
library.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code> – If the velocity scale, spectral resolution, or
file name for the processed data are not define.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-3">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>type checking</li>
<li>If a DRP file is provided, the processing to a logarithmic
binning is done by default (log=True).  But linearly
sampled DRP data are available, so need to have
<a class="reference internal" href="mangadap.drpfits.html#mangadap.drpfits.DRPFits" title="mangadap.drpfits.DRPFits"><code class="xref py py-class docutils literal"><span class="pre">mangadap.drpfits.DRPFits</span></code></a> return the spectral
sampling type.</li>
<li>Documentation needs updating!</li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.read_raw_template_library">
<code class="descname">read_raw_template_library</code><span class="sig-paren">(</span><em>library_key=None</em>, <em>tpllib_list=None</em>, <em>dapsrc=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary.read_raw_template_library"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.read_raw_template_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the identified template library.  If all the arguments are
the default, the preset attributes from the initialization of
the object are used.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>library_key</strong> (<em>str</em>) – (<strong>Optional</strong>) Keyword selecting the library
to use.</li>
<li><strong>tpllib_list</strong> (<em>list</em>) – (<strong>Optional</strong>) List of
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-class docutils literal"><span class="pre">TemplateLibraryDef</span></code></a>
objects that define the parameters required to read and
interpret a template library.</li>
<li><strong>dapsrc</strong> (<em>str</em>) – (<strong>Optional</strong>) Root path to the DAP source
directory.  If not provided, the default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_source" title="mangadap.config.defaults.default_dap_source"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_source()</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="mangadap.proc.templatelibrary.TemplateLibrary.single_spec_to_fits">
<code class="descname">single_spec_to_fits</code><span class="sig-paren">(</span><em>i</em>, <em>ofile</em>, <em>clobber=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibrary.single_spec_to_fits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibrary.single_spec_to_fits" title="Permalink to this definition">¶</a></dt>
<dd><p>Write one of the template spectra to a 1D fits file.</p>
<p>Output is a one-dimensional fits file with a single extension
containing the flux measurements and headers keywords needed to
determine the wavelength of each pixel.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>i</strong> (<em>int</em>) – Index of the spectrum in the avaiable list to
output.</li>
<li><strong>ofile</strong> (<em>str</em>) – Name of the file to write</li>
<li><strong>clobber</strong> (<em>bool</em>) – (<strong>Optional</strong>) Flag to clobber any existing
file of the same name.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code> – Raised if the selected index is not available.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="mangadap.proc.templatelibrary.TemplateLibraryBitMask">
<em class="property">class </em><code class="descclassname">mangadap.proc.templatelibrary.</code><code class="descname">TemplateLibraryBitMask</code><span class="sig-paren">(</span><em>dapsrc=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibraryBitMask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibraryBitMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="mangadap.util.bitmask.html#mangadap.util.bitmask.BitMask" title="mangadap.util.bitmask.BitMask"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.bitmask.BitMask</span></code></a></p>
<p>Derived class that specifies the mask bits for the template library
data.  See <a class="reference internal" href="mangadap.util.bitmask.html#mangadap.util.bitmask.BitMask" title="mangadap.util.bitmask.BitMask"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.bitmask.BitMask</span></code></a> for attributes.</p>
<p>A list of the bits and meanings are provided by the base class
function <a class="reference internal" href="mangadap.util.bitmask.html#mangadap.util.bitmask.BitMask.info" title="mangadap.util.bitmask.BitMask.info"><code class="xref py py-func docutils literal"><span class="pre">mangadap.util.bitmask.BitMask.info()</span></code></a>; i.e.,:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mangadap.proc.templatelibrary</span> <span class="k">import</span> <span class="n">TemplateLibraryBitMask</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">TemplateLibraryBitMask</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mangadap.proc.templatelibrary.TemplateLibraryDef">
<em class="property">class </em><code class="descclassname">mangadap.proc.templatelibrary.</code><code class="descname">TemplateLibraryDef</code><span class="sig-paren">(</span><em>key=None</em>, <em>file_search=None</em>, <em>fwhm=None</em>, <em>sres_ext=None</em>, <em>in_vacuum=False</em>, <em>wave_limit=None</em>, <em>lower_flux_limit=None</em>, <em>log10=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#TemplateLibraryDef"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="mangadap.par.parset.html#mangadap.par.parset.ParSet" title="mangadap.par.parset.ParSet"><code class="xref py py-class docutils literal"><span class="pre">mangadap.par.parset.ParSet</span></code></a></p>
<p>Class with parameters used to define the template library.
See <a class="reference internal" href="mangadap.par.parset.html#mangadap.par.parset.ParSet" title="mangadap.par.parset.ParSet"><code class="xref py py-class docutils literal"><span class="pre">mangadap.par.parset.ParSet</span></code></a> for attributes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<em>str</em>) – Keyword to distinguish the template library.</li>
<li><strong>file_search</strong> (<em>str</em>) – Search string used by glob to find the 1D
fits spectra to include in the template library.</li>
<li><strong>fwhm</strong> (<em>int</em><em> or </em><em>float</em>) – FWHM of the resolution element in
angstroms.</li>
<li><strong>sres_ext</strong> (<em>str</em>) – Extension in the fits files with measurements of
the spectral resolution as a function of wavelength.</li>
<li><strong>in_vacuum</strong> (<em>bool</em>) – Flag that the wavelengths of the spectra are
in vacuum, not air.</li>
<li><strong>wave_limit</strong> (<em>numpy.ndarray</em>) – 2-element array with the starting
and ending wavelengths for the valid spectral range of the
templates.</li>
<li><strong>lower_flux_limit</strong> (<em>int</em><em> or </em><em>float</em>) – Minimum valid flux in the
template spectra.</li>
<li><strong>log10</strong> (<em>bool</em>) – Flag that the template spectra have been binned
logarithmically in wavelength.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mangadap.proc.templatelibrary.available_template_libraries">
<code class="descclassname">mangadap.proc.templatelibrary.</code><code class="descname">available_template_libraries</code><span class="sig-paren">(</span><em>dapsrc=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#available_template_libraries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.available_template_libraries" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the list of library keys, the searchable string of the 1D
template library fits files for the template libraries available for
use by the DAP, the FWHM of the libraries, and whether or not the
wavelengths are in vacuum.</p>
<p>The stellar template library files should be a list of 1D fits
files, and be associated with one of the following library keys:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="21%" />
<col width="16%" />
<col width="22%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">KEY</th>
<th class="head"><blockquote class="first">
<div>Spectral</div></blockquote>
<p class="last">res (ang)</p>
</th>
<th class="head">Vacuum</th>
<th class="head"><blockquote class="first">
<div>Wavelength</div></blockquote>
<p class="last">Range (ang)</p>
</th>
<th class="head">Lower
Limit</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>M11MARCS</td>
<td>2.73</td>
<td>No</td>
<td>full</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>M11STELIB</td>
<td>3.40</td>
<td>No</td>
<td>full</td>
<td>None</td>
</tr>
<tr class="row-even"><td>M11STELIBZSOL</td>
<td>3.40</td>
<td>No</td>
<td>full</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>M11ELODIE</td>
<td>0.55</td>
<td>No</td>
<td>&lt; 6795</td>
<td>None</td>
</tr>
<tr class="row-even"><td>M11MILES</td>
<td>2.54</td>
<td>No</td>
<td>3550 - 7400</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>MILES</td>
<td>2.50</td>
<td>No</td>
<td>&lt; 7400</td>
<td>None</td>
</tr>
<tr class="row-even"><td>MILESAVG</td>
<td>2.50</td>
<td>No</td>
<td>&lt; 7400</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>MILESTHIN</td>
<td>2.50</td>
<td>No</td>
<td>&lt; 7400</td>
<td>None</td>
</tr>
<tr class="row-even"><td>MILESHC</td>
<td>2.50</td>
<td>No</td>
<td>&lt; 7400</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>STELIB</td>
<td>3.40</td>
<td>No</td>
<td>full</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>MIUSCAT</td>
<td>2.51</td>
<td>No</td>
<td>3480 - 9430</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>MIUSCATTHIN</td>
<td>2.51</td>
<td>No</td>
<td>3480 - 9430</td>
<td>None</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>dapsrc</strong> (<em>str</em>) – (<strong>Optional</strong>) Root path to the DAP source
directory.  If not provided, the default is defined by
<a class="reference internal" href="mangadap.config.defaults.html#mangadap.config.defaults.default_dap_source" title="mangadap.config.defaults.default_dap_source"><code class="xref py py-func docutils literal"><span class="pre">mangadap.config.defaults.default_dap_source()</span></code></a>.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A list of
<a class="reference internal" href="#mangadap.proc.templatelibrary.TemplateLibraryDef" title="mangadap.proc.templatelibrary.TemplateLibraryDef"><code class="xref py py-func docutils literal"><span class="pre">mangadap.proc.templatelibrary.TemplateLibraryDef()</span></code></a>
objects, each defining a separate template library.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">list</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><code class="xref py py-exc docutils literal"><span class="pre">NotADirectoryError</span></code> – Raised if the provided or default
<em>dapsrc</em> is not a directory.</li>
<li><code class="xref py py-exc docutils literal"><span class="pre">OSError/IOError</span></code> – Raised if no template configuration files could
be found.</li>
<li><code class="xref py py-exc docutils literal"><span class="pre">KeyError</span></code> – Raised if the template-library keywords are not all
unique.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-4">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Add backup function for Python 2.</li>
<li>Somehow add a python call that reads the databases and
constructs the table for presentation in sphinx so that the
text above doesn’t have to be edited with changes in the
available databases.</li>
</ul>
</div>
</dd></dl>

<dl class="function">
<dt id="mangadap.proc.templatelibrary.validate_spectral_template_config">
<code class="descclassname">mangadap.proc.templatelibrary.</code><code class="descname">validate_spectral_template_config</code><span class="sig-paren">(</span><em>cnfg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mangadap/proc/templatelibrary.html#validate_spectral_template_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mangadap.proc.templatelibrary.validate_spectral_template_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate the <a class="reference internal" href="mangadap.util.parser.html#mangadap.util.parser.DefaultConfig" title="mangadap.util.parser.DefaultConfig"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.parser.DefaultConfig</span></code></a> object with
the template library parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>cnfg</strong> (<a class="reference internal" href="mangadap.util.parser.html#mangadap.util.parser.DefaultConfig" title="mangadap.util.parser.DefaultConfig"><code class="xref py py-class docutils literal"><span class="pre">mangadap.util.parser.DefaultConfig</span></code></a>) – Object with
the template library parameters to validate.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><code class="xref py py-exc docutils literal"><span class="pre">KeyError</span></code> – Raised if required keyword does not exist.</li>
<li><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code> – Raised if key has unacceptable value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mangadap.proc.util.html" class="btn btn-neutral float-right" title="mangadap.proc.util module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mangadap.proc.stellarcontinuummodel.html" class="btn btn-neutral" title="mangadap.proc.stellarcontinuummodel module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, SDSS-IV/MaNGA Pipeline Group.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>